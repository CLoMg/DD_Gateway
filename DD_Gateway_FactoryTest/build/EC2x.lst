ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"EC2x.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.ec2x_waitreply,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	ec2x_waitreply:
  26              	.LVL0:
  27              	.LFB302:
  28              		.file 1 "FML/Src/EC2x.c"
   1:FML/Src/EC2x.c **** /**
   2:FML/Src/EC2x.c ****  ******************************************************************************
   3:FML/Src/EC2x.c **** *
   4:FML/Src/EC2x.c **** * @file   
   5:FML/Src/EC2x.c **** *
   6:FML/Src/EC2x.c **** * @brief   
   7:FML/Src/EC2x.c **** *
   8:FML/Src/EC2x.c **** * @attention
   9:FML/Src/EC2x.c **** *
  10:FML/Src/EC2x.c **** *Copyright (c) 2023 STMicroelectronics.
  11:FML/Src/EC2x.c **** *
  12:FML/Src/EC2x.c **** *All rights reserved.
  13:FML/Src/EC2x.c ****  ******************************************************************************
  14:FML/Src/EC2x.c **** */
  15:FML/Src/EC2x.c **** 
  16:FML/Src/EC2x.c **** 
  17:FML/Src/EC2x.c **** /*----------------------------------include-----------------------------------*/
  18:FML/Src/EC2x.c **** #include "EC2x.h"
  19:FML/Src/EC2x.c **** #include "usart.h"
  20:FML/Src/EC2x.c **** #include "timer.h"
  21:FML/Src/EC2x.c **** #include "shell_port.h"
  22:FML/Src/EC2x.c **** #include <stdio.h>
  23:FML/Src/EC2x.c **** #include "fsm.h"
  24:FML/Src/EC2x.c **** #include "queue.h"
  25:FML/Src/EC2x.c **** /*-----------------------------------macro------------------------------------*/
  26:FML/Src/EC2x.c **** #define BUFF_LEN 200
  27:FML/Src/EC2x.c **** /*----------------------------------typedef-----------------------------------*/
  28:FML/Src/EC2x.c **** void ec2x_queue_send(void);
  29:FML/Src/EC2x.c **** void ec2x_reply_handler(void);
  30:FML/Src/EC2x.c **** void ex2x_timeout_handler(void);
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 2


  31:FML/Src/EC2x.c **** /*----------------------------------variable----------------------------------*/
  32:FML/Src/EC2x.c **** uint8_t ec2x_buff[BUFF_LEN]={0xff,};
  33:FML/Src/EC2x.c **** 
  34:FML/Src/EC2x.c **** FSM_T ec2x_fsm;
  35:FML/Src/EC2x.c **** 
  36:FML/Src/EC2x.c **** StateTransform_T ec2x_transtable[] = 
  37:FML/Src/EC2x.c **** {
  38:FML/Src/EC2x.c **** 	{UINIT,Timeout_Event,UINIT,ec2x_reset},
  39:FML/Src/EC2x.c **** 	{UINIT,ReplyScs_Event,AT_MODE,NULL},
  40:FML/Src/EC2x.c **** 	{AT_MODE,CMDSend_Event,WAIT_REPLY,ec2x_queue_send},
  41:FML/Src/EC2x.c **** 	{WAIT_REPLY,ReplyScs_Event,AT_MODE,ec2x_reply_handler},
  42:FML/Src/EC2x.c **** 	{WAIT_REPLY,Timeout_Event,AT_MODE,ex2x_timeout_handler},
  43:FML/Src/EC2x.c **** 	{TRANS_MODE,MsgSend_Event,TRANS_MODE,NULL},
  44:FML/Src/EC2x.c **** };
  45:FML/Src/EC2x.c **** 
  46:FML/Src/EC2x.c **** //定义事件队列
  47:FML/Src/EC2x.c **** uint8_t event_buff[10];
  48:FML/Src/EC2x.c **** Queue_HandleTypeDef ec2x_event_queue;
  49:FML/Src/EC2x.c **** //定义tcp连接字符串
  50:FML/Src/EC2x.c **** uint8_t tcp_connect[]="AT+QIOPEN=1,0,\"TCP\",\"115.236.153.170\",52894,0,2";
  51:FML/Src/EC2x.c **** 
  52:FML/Src/EC2x.c **** //定义tcp连接指令队列
  53:FML/Src/EC2x.c **** uint8_t tcpconnct_step = 0;
  54:FML/Src/EC2x.c **** ATMsg_TypeDef connectmsg_queue[] = {
  55:FML/Src/EC2x.c ****    // {"AT\r\n","OK",500,5},
  56:FML/Src/EC2x.c ****     {"AT+CPIN?\r\n","+CPIN: READY",500,5},
  57:FML/Src/EC2x.c ****     {"AT+CREG?\r\n","+CREG: 0,1", 500, 2},
  58:FML/Src/EC2x.c ****     {"AT+CGREG?\r\n","+CGREG: 0,1", 500, 2},
  59:FML/Src/EC2x.c ****     {"AT+QICSGP=1,1,\"CMNET\",\"\",\"\",1\r\n","OK", 500, 3},
  60:FML/Src/EC2x.c ****     {"AT+QIDEACT=1\r\n", "OK", 40, 1},
  61:FML/Src/EC2x.c ****     {"AT+QIACT=1\r\n", "OK", 150, 1},
  62:FML/Src/EC2x.c ****     {tcp_connect, "+QIOPEN:", 150, 5},
  63:FML/Src/EC2x.c **** };
  64:FML/Src/EC2x.c **** 
  65:FML/Src/EC2x.c **** //定义发送消息队列
  66:FML/Src/EC2x.c **** ATMsg_TypeDef ec2x_txmsg_buff[5];
  67:FML/Src/EC2x.c **** Queue_HandleTypeDef ec2x_txmsg_queue;
  68:FML/Src/EC2x.c **** ATMsg_TypeDef *cur_msg = NULL;
  69:FML/Src/EC2x.c **** 
  70:FML/Src/EC2x.c **** /*----------------------------------typedef-----------------------------------*/
  71:FML/Src/EC2x.c **** 
  72:FML/Src/EC2x.c **** EC2x_HandleTypeDef ec2x_dev[]=
  73:FML/Src/EC2x.c **** {
  74:FML/Src/EC2x.c ****     {
  75:FML/Src/EC2x.c ****         "uart1/ec200s",
  76:FML/Src/EC2x.c ****         &huart1,
  77:FML/Src/EC2x.c ****         GPIOA,
  78:FML/Src/EC2x.c ****         GPIO_PIN_12,
  79:FML/Src/EC2x.c ****         GPIOA,
  80:FML/Src/EC2x.c ****         GPIO_PIN_8,
  81:FML/Src/EC2x.c ****         GPIOA,
  82:FML/Src/EC2x.c ****         GPIO_PIN_11,
  83:FML/Src/EC2x.c ****         {
  84:FML/Src/EC2x.c ****             0,
  85:FML/Src/EC2x.c ****            ec2x_buff,
  86:FML/Src/EC2x.c ****             0,
  87:FML/Src/EC2x.c ****             0,
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 3


  88:FML/Src/EC2x.c ****             0,
  89:FML/Src/EC2x.c ****             BUFF_LEN 
  90:FML/Src/EC2x.c ****         }
  91:FML/Src/EC2x.c ****     }
  92:FML/Src/EC2x.c **** };
  93:FML/Src/EC2x.c **** /*-------------------------------------os-------------------------------------*/
  94:FML/Src/EC2x.c **** 
  95:FML/Src/EC2x.c **** /*----------------------------------function----------------------------------*/
  96:FML/Src/EC2x.c **** 
  97:FML/Src/EC2x.c **** /**
  98:FML/Src/EC2x.c ****  * @brief 设备初始化函数
  99:FML/Src/EC2x.c ****  * 
 100:FML/Src/EC2x.c ****  */
 101:FML/Src/EC2x.c **** void ec2x_io_init(EC2x_HandleTypeDef *device)
 102:FML/Src/EC2x.c **** {
 103:FML/Src/EC2x.c ****      GPIO_InitTypeDef GPIO_InitStruct = {0};
 104:FML/Src/EC2x.c ****     
 105:FML/Src/EC2x.c ****     // 使能UART和GPIO时钟
 106:FML/Src/EC2x.c ****     //__HAL_RCC_UARTX_CLK_ENABLE(); // 替换为实际的UART时钟
 107:FML/Src/EC2x.c ****     __HAL_RCC_GPIOA_CLK_ENABLE(); // 替换为实际的GPIO时钟
 108:FML/Src/EC2x.c ****     
 109:FML/Src/EC2x.c ****     // 配置GPIO引脚
 110:FML/Src/EC2x.c ****     GPIO_InitStruct.Pin = device->reset_pin;
 111:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 112:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 113:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 114:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->reset_port, &GPIO_InitStruct);
 115:FML/Src/EC2x.c **** 
 116:FML/Src/EC2x.c ****     GPIO_InitStruct.Pin = device->wake_pin;
 117:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 118:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 119:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 120:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->wake_port, &GPIO_InitStruct);
 121:FML/Src/EC2x.c **** 
 122:FML/Src/EC2x.c ****     GPIO_InitStruct.Pin = device->pwren_pin;
 123:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 124:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 125:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 126:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->pwren_port, &GPIO_InitStruct);
 127:FML/Src/EC2x.c ****     
 128:FML/Src/EC2x.c ****     
 129:FML/Src/EC2x.c ****     // 初始化复位引脚为高电平
 130:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->reset_port, device->reset_pin, GPIO_PIN_SET);
 131:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->wake_port, device->wake_pin, GPIO_PIN_SET);
 132:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_SET);
 133:FML/Src/EC2x.c ****     HAL_Delay(1000);
 134:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_RESET);
 135:FML/Src/EC2x.c **** }
 136:FML/Src/EC2x.c **** /**
 137:FML/Src/EC2x.c ****  * @brief 通过POWEREN引脚，对模块进行掉电复位
 138:FML/Src/EC2x.c ****  * 
 139:FML/Src/EC2x.c ****  * @param fd 
 140:FML/Src/EC2x.c ****  * @return int 
 141:FML/Src/EC2x.c ****  */
 142:FML/Src/EC2x.c **** int ec2x_reset(int fd){
 143:FML/Src/EC2x.c ****     fd = 0;
 144:FML/Src/EC2x.c ****     int err_code = 0;
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 4


 145:FML/Src/EC2x.c ****     // if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
 146:FML/Src/EC2x.c ****     //     return (err_code = -1);
 147:FML/Src/EC2x.c ****     // else{
 148:FML/Src/EC2x.c ****     //     EC2x_HandleTypeDef *device = &ec2x_dev[fd];
 149:FML/Src/EC2x.c ****     //     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_SET);
 150:FML/Src/EC2x.c ****     //     HAL_Delay(500);
 151:FML/Src/EC2x.c ****     //     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_RESET);
 152:FML/Src/EC2x.c ****     // }
 153:FML/Src/EC2x.c **** 
 154:FML/Src/EC2x.c ****     ec2x_waitreply("RDY\r\n",10000);
 155:FML/Src/EC2x.c ****     // ATMsg_TypeDef *msg_send = (ATMsg_TypeDef *)malloc(sizeof(ATMsg_TypeDef));
 156:FML/Src/EC2x.c ****     // char *reply_data = (char *)malloc(sizeof("RDY\r\n"));
 157:FML/Src/EC2x.c **** 
 158:FML/Src/EC2x.c ****     // memcpy(reply_data,"RDY\r\n",sizeof("RDY\r\n"));
 159:FML/Src/EC2x.c ****     
 160:FML/Src/EC2x.c ****     // msg_send->expect_reply = reply_data;
 161:FML/Src/EC2x.c ****     // msg_send->retry_times = 0;
 162:FML/Src/EC2x.c ****     // msg_send->timeout = 10000;
 163:FML/Src/EC2x.c ****     // msg_send->txmsg = NULL;
 164:FML/Src/EC2x.c **** 
 165:FML/Src/EC2x.c ****     // queue_insert(&ec2x_txmsg_queue,msg_send);
 166:FML/Src/EC2x.c ****     queue_insert(&ec2x_event_queue,(uint8_t)Timeout_Event);
 167:FML/Src/EC2x.c **** }
 168:FML/Src/EC2x.c **** 
 169:FML/Src/EC2x.c **** /**
 170:FML/Src/EC2x.c ****  * @brief 设备文件open函数
 171:FML/Src/EC2x.c ****  * 
 172:FML/Src/EC2x.c ****  * @param dev_name 
 173:FML/Src/EC2x.c ****  * @return int 
 174:FML/Src/EC2x.c ****  *         返回设备文件索引，未查找到则返回-1
 175:FML/Src/EC2x.c ****  */
 176:FML/Src/EC2x.c **** int ec2x_open(char *dev_name)
 177:FML/Src/EC2x.c **** {
 178:FML/Src/EC2x.c ****     uint8_t i = 0;
 179:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 180:FML/Src/EC2x.c ****     {
 181:FML/Src/EC2x.c ****         if(strcmp(dev_name,ec2x_dev[i].dev_name) == 0)
 182:FML/Src/EC2x.c ****         {
 183:FML/Src/EC2x.c ****             ec2x_io_init(&ec2x_dev[i]);
 184:FML/Src/EC2x.c **** 
 185:FML/Src/EC2x.c ****             queue_init(&ec2x_event_queue,event_buff,10);
 186:FML/Src/EC2x.c ****             queue_init(&ec2x_txmsg_queue,ec2x_txmsg_buff,5);
 187:FML/Src/EC2x.c ****         
 188:FML/Src/EC2x.c ****            // ec2x_fsm = (FSM_T*)malloc(sizeof(FSM_T));
 189:FML/Src/EC2x.c ****             uint8_t num = sizeof(ec2x_transtable)/sizeof(ec2x_transtable[0]);
 190:FML/Src/EC2x.c ****             FSM_Regist(&ec2x_fsm,ec2x_transtable,num,UINIT);
 191:FML/Src/EC2x.c ****             queue_insert(&ec2x_event_queue,(uint8_t)Timeout_Event);
 192:FML/Src/EC2x.c ****             return i;
 193:FML/Src/EC2x.c ****         }
 194:FML/Src/EC2x.c ****     }
 195:FML/Src/EC2x.c ****     return -1;
 196:FML/Src/EC2x.c **** };
 197:FML/Src/EC2x.c **** 
 198:FML/Src/EC2x.c **** /**
 199:FML/Src/EC2x.c ****  * @brief 设备文件close函数
 200:FML/Src/EC2x.c ****  * 
 201:FML/Src/EC2x.c ****  * @param fd 
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 5


 202:FML/Src/EC2x.c ****  * @return int 
 203:FML/Src/EC2x.c ****  */
 204:FML/Src/EC2x.c **** int ec2x_close(int fd);
 205:FML/Src/EC2x.c **** 
 206:FML/Src/EC2x.c **** /**
 207:FML/Src/EC2x.c ****  * @brief 设备文件写入函数
 208:FML/Src/EC2x.c ****  * 
 209:FML/Src/EC2x.c ****  * @param fd 
 210:FML/Src/EC2x.c ****  * @param tx_buff 
 211:FML/Src/EC2x.c ****  * @param len 
 212:FML/Src/EC2x.c ****  * @return int 
 213:FML/Src/EC2x.c ****  *         设备号无效返回-1
 214:FML/Src/EC2x.c ****  *         写入失败返回 0
 215:FML/Src/EC2x.c ****  *          写入成功返回1
 216:FML/Src/EC2x.c ****  *         
 217:FML/Src/EC2x.c ****  */
 218:FML/Src/EC2x.c **** int ec2x_write(int fd,uint8_t *tx_buff,uint16_t len){
 219:FML/Src/EC2x.c ****     int err_code = 0;
 220:FML/Src/EC2x.c ****     if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
 221:FML/Src/EC2x.c ****         return (err_code = -1);
 222:FML/Src/EC2x.c ****     else{
 223:FML/Src/EC2x.c ****         err_code =  HAL_UART_Transmit_IT(ec2x_dev[fd].huart, tx_buff,len);
 224:FML/Src/EC2x.c ****         return(!err_code);
 225:FML/Src/EC2x.c ****     }
 226:FML/Src/EC2x.c **** };
 227:FML/Src/EC2x.c **** /**
 228:FML/Src/EC2x.c ****  * @brief 设备文件读取函数
 229:FML/Src/EC2x.c ****  *        读取环形缓冲区指定长度数据
 230:FML/Src/EC2x.c ****  * 
 231:FML/Src/EC2x.c ****  * @param fd 
 232:FML/Src/EC2x.c ****  * @param rx_buff 
 233:FML/Src/EC2x.c ****  * @param len 
 234:FML/Src/EC2x.c ****  * @return int 
 235:FML/Src/EC2x.c ****  *         -1 接口错误
 236:FML/Src/EC2x.c ****  *          0 读取失败
 237:FML/Src/EC2x.c ****  *          n 读取成功字节数
 238:FML/Src/EC2x.c ****  */
 239:FML/Src/EC2x.c **** int ec2x_read(int fd,uint8_t *rx_buff,uint16_t len){
 240:FML/Src/EC2x.c ****     uint8_t *dest = rx_buff;
 241:FML/Src/EC2x.c ****     if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
 242:FML/Src/EC2x.c ****         return -1;
 243:FML/Src/EC2x.c ****     else{
 244:FML/Src/EC2x.c ****         uint16_t j = 0;
 245:FML/Src/EC2x.c ****         
 246:FML/Src/EC2x.c ****         RingBuffer_TypeDef *src = &ec2x_dev[fd].msg;
 247:FML/Src/EC2x.c ****         //如果队列被上锁了，则等待100ms
 248:FML/Src/EC2x.c ****         if(src->block == 1)
 249:FML/Src/EC2x.c ****         {
 250:FML/Src/EC2x.c ****             HAL_Delay(100);
 251:FML/Src/EC2x.c ****             if(src->block == 1)
 252:FML/Src/EC2x.c ****                 return 0;
 253:FML/Src/EC2x.c ****         }
 254:FML/Src/EC2x.c ****         else{
 255:FML/Src/EC2x.c ****             src->block = 1;
 256:FML/Src/EC2x.c ****             if(len > src->size)
 257:FML/Src/EC2x.c ****                 len = src->size;
 258:FML/Src/EC2x.c ****             for(j = 0 ; j < len; j++){
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 6


 259:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 260:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
 261:FML/Src/EC2x.c ****                 src->size--;
 262:FML/Src/EC2x.c ****             }
 263:FML/Src/EC2x.c ****             src->block = 0;
 264:FML/Src/EC2x.c ****         }
 265:FML/Src/EC2x.c ****         return len;
 266:FML/Src/EC2x.c ****     }
 267:FML/Src/EC2x.c **** };
 268:FML/Src/EC2x.c **** int ec2x_ioctl(int fd);
 269:FML/Src/EC2x.c **** 
 270:FML/Src/EC2x.c **** /**
 271:FML/Src/EC2x.c ****  * @brief 将串口接收数据copy到环形缓冲区，并更新缓冲区状态
 272:FML/Src/EC2x.c ****  * 
 273:FML/Src/EC2x.c ****  * @param huart 
 274:FML/Src/EC2x.c ****  * @param data 
 275:FML/Src/EC2x.c ****  * @param len 
 276:FML/Src/EC2x.c ****  */
 277:FML/Src/EC2x.c **** void ec2x_handler(UART_HandleTypeDef *huart,uint8_t *data,uint16_t len)
 278:FML/Src/EC2x.c **** {
 279:FML/Src/EC2x.c ****     uint8_t i = 0,j = 0;
 280:FML/Src/EC2x.c ****     shellPrint(&shell,"%s",data);
 281:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 282:FML/Src/EC2x.c ****     {
 283:FML/Src/EC2x.c ****         if(huart == ec2x_dev[i].huart)
 284:FML/Src/EC2x.c ****         {
 285:FML/Src/EC2x.c ****             RingBuffer_TypeDef *dest = &ec2x_dev[i].msg;
 286:FML/Src/EC2x.c ****             if(dest->block  == 0){
 287:FML/Src/EC2x.c ****                 dest->block = 1;
 288:FML/Src/EC2x.c ****                 for(j = 0 ; j < len; j++){
 289:FML/Src/EC2x.c ****                    
 290:FML/Src/EC2x.c ****                     dest->data[dest->tail] = data[j];
 291:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 292:FML/Src/EC2x.c ****                     dest->size++;
 293:FML/Src/EC2x.c ****                     dest->size = dest->size > dest->capacity ? dest->capacity : dest->size;
 294:FML/Src/EC2x.c ****                 }
 295:FML/Src/EC2x.c ****                 if((dest->tail > dest->head)&&(dest->size == dest->capacity))
 296:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 297:FML/Src/EC2x.c ****                 dest->block = 0;
 298:FML/Src/EC2x.c ****             }
 299:FML/Src/EC2x.c ****         }
 300:FML/Src/EC2x.c ****     }
 301:FML/Src/EC2x.c **** }
 302:FML/Src/EC2x.c **** 
 303:FML/Src/EC2x.c **** static uint8_t timeout_cnt = 0;
 304:FML/Src/EC2x.c **** 
 305:FML/Src/EC2x.c **** /**
 306:FML/Src/EC2x.c ****  * @brief 回复匹配函数
 307:FML/Src/EC2x.c ****  *        1）匹配成功，则插入回复成功事件
 308:FML/Src/EC2x.c ****  *        2.1）匹配失败，超时次数-1
 309:FML/Src/EC2x.c ****  *        2.2）匹配失败，超时次数=0，插入超时事件消息
 310:FML/Src/EC2x.c ****  * 
 311:FML/Src/EC2x.c ****  * @param expect 
 312:FML/Src/EC2x.c ****  * @return int 
 313:FML/Src/EC2x.c ****  */
 314:FML/Src/EC2x.c **** int ec2x_replymatch(char* expect){
 315:FML/Src/EC2x.c ****     uint8_t rx_buff[300]  = {0x00};
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 7


 316:FML/Src/EC2x.c ****     int bytes_num = 0;
 317:FML/Src/EC2x.c ****     bytes_num =  ec2x_read(0,rx_buff,200);
 318:FML/Src/EC2x.c ****     if(bytes_num > 0)
 319:FML/Src/EC2x.c ****     {
 320:FML/Src/EC2x.c ****         if(strstr(rx_buff,expect) != NULL){
 321:FML/Src/EC2x.c ****              shellPrint(&shell,"recv success");
 322:FML/Src/EC2x.c ****              queue_insert(&ec2x_event_queue,(uint8_t)ReplyScs_Event);
 323:FML/Src/EC2x.c ****             return 1;
 324:FML/Src/EC2x.c ****         }
 325:FML/Src/EC2x.c ****     }
 326:FML/Src/EC2x.c ****     
 327:FML/Src/EC2x.c ****     if(timeout_cnt == 0){
 328:FML/Src/EC2x.c ****         shellPrint(&shell,"no valid data\r\n");
 329:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)Timeout_Event);
 330:FML/Src/EC2x.c ****     }
 331:FML/Src/EC2x.c ****     else
 332:FML/Src/EC2x.c ****         timeout_cnt--;
 333:FML/Src/EC2x.c ****     return 0;
 334:FML/Src/EC2x.c **** }
 335:FML/Src/EC2x.c **** 
 336:FML/Src/EC2x.c **** //扫描发送消息队列是否有消息，有则发送队首消息
 337:FML/Src/EC2x.c **** void ec2x_queue_send(void){
 338:FML/Src/EC2x.c ****     
 339:FML/Src/EC2x.c ****     if(!queue_is_empty(&ec2x_txmsg_queue)){
 340:FML/Src/EC2x.c ****         if(queue_pull(&ec2x_txmsg_queue,&cur_msg,1))
 341:FML/Src/EC2x.c ****             ec2x_cmd_send(0,cur_msg->txmsg,sizeof(cur_msg->txmsg),cur_msg->expect_reply,cur_msg->ti
 342:FML/Src/EC2x.c ****     }      
 343:FML/Src/EC2x.c **** }
 344:FML/Src/EC2x.c **** 
 345:FML/Src/EC2x.c **** /**
 346:FML/Src/EC2x.c ****  * @brief 接收回复成功回调函数
 347:FML/Src/EC2x.c ****  *        1）将消息pop出队列
 348:FML/Src/EC2x.c ****  *        2）如果出队后消息队列还有元素，则插入指令发送事件
 349:FML/Src/EC2x.c ****  * 
 350:FML/Src/EC2x.c ****  */
 351:FML/Src/EC2x.c **** void ec2x_reply_handler(void){
 352:FML/Src/EC2x.c **** 
 353:FML/Src/EC2x.c ****     if(!queue_is_empty(&ec2x_txmsg_queue)){
 354:FML/Src/EC2x.c ****         queue_pop(&ec2x_txmsg_queue,&cur_msg,1);
 355:FML/Src/EC2x.c ****         free(cur_msg->expect_reply);
 356:FML/Src/EC2x.c ****         cur_msg->expect_reply = NULL;
 357:FML/Src/EC2x.c ****         free(cur_msg->txmsg);
 358:FML/Src/EC2x.c ****         cur_msg->txmsg = NULL;
 359:FML/Src/EC2x.c ****         free(cur_msg);
 360:FML/Src/EC2x.c ****         cur_msg = NULL;
 361:FML/Src/EC2x.c ****     }
 362:FML/Src/EC2x.c ****     if(!queue_is_empty(&ec2x_txmsg_queue)){
 363:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 364:FML/Src/EC2x.c ****     }        
 365:FML/Src/EC2x.c **** }
 366:FML/Src/EC2x.c **** 
 367:FML/Src/EC2x.c **** /**
 368:FML/Src/EC2x.c ****  * @brief 超时处理回调函数
 369:FML/Src/EC2x.c ****  *        如果retry_times > 0 则减1，再插入指令发送事件
 370:FML/Src/EC2x.c ****  *        如果retry_times = 0 则将消息出队
 371:FML/Src/EC2x.c ****  * 
 372:FML/Src/EC2x.c ****  */
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 8


 373:FML/Src/EC2x.c **** void ex2x_timeout_handler(void){
 374:FML/Src/EC2x.c ****     cur_msg->retry_times--;
 375:FML/Src/EC2x.c ****     if(cur_msg->retry_times == 0){
 376:FML/Src/EC2x.c ****         if(!queue_is_empty(&ec2x_txmsg_queue)){
 377:FML/Src/EC2x.c ****             queue_pop(&ec2x_txmsg_queue,&cur_msg,1); 
 378:FML/Src/EC2x.c ****             free(cur_msg->expect_reply);
 379:FML/Src/EC2x.c ****             cur_msg->expect_reply = NULL;
 380:FML/Src/EC2x.c ****             free(cur_msg->txmsg);
 381:FML/Src/EC2x.c ****             cur_msg->txmsg = NULL;
 382:FML/Src/EC2x.c ****             free(cur_msg);
 383:FML/Src/EC2x.c ****             cur_msg = NULL; 
 384:FML/Src/EC2x.c ****         }     
 385:FML/Src/EC2x.c ****     }
 386:FML/Src/EC2x.c ****     else
 387:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event); 
 388:FML/Src/EC2x.c **** }
 389:FML/Src/EC2x.c **** 
 390:FML/Src/EC2x.c **** /**
 391:FML/Src/EC2x.c ****  * @brief ec2x指令发送函数
 392:FML/Src/EC2x.c ****  *        1）发送指令
 393:FML/Src/EC2x.c ****  *        2）进入等待回复状态
 394:FML/Src/EC2x.c ****  * @param fd 
 395:FML/Src/EC2x.c ****  * @param tx_buff 
 396:FML/Src/EC2x.c ****  * @param len 
 397:FML/Src/EC2x.c ****  * @param expect_reply 
 398:FML/Src/EC2x.c ****  * @param timeout 
 399:FML/Src/EC2x.c ****  */
 400:FML/Src/EC2x.c **** void ec2x_cmd_send(int fd,uint8_t *tx_buff,uint16_t len,uint8_t *expect_reply,uint16_t timeout)
 401:FML/Src/EC2x.c **** {
 402:FML/Src/EC2x.c ****     if(tx_buff !=NULL)
 403:FML/Src/EC2x.c ****         ec2x_write(fd,tx_buff,len);
 404:FML/Src/EC2x.c ****     ec2x_waitreply(expect_reply,timeout);
 405:FML/Src/EC2x.c **** }
 406:FML/Src/EC2x.c **** 
 407:FML/Src/EC2x.c **** /**
 408:FML/Src/EC2x.c ****  * @brief ec2x 进入等待回复状态
 409:FML/Src/EC2x.c ****  *        拷贝期待回复指令
 410:FML/Src/EC2x.c ****  *        插入timer列表
 411:FML/Src/EC2x.c ****  * 
 412:FML/Src/EC2x.c ****  * @param expect 
 413:FML/Src/EC2x.c ****  * @param timeout 
 414:FML/Src/EC2x.c ****  * @return * void 
 415:FML/Src/EC2x.c ****  */
 416:FML/Src/EC2x.c **** void ec2x_waitreply(uint8_t *expect,uint16_t timeout){
  29              		.loc 1 416 54 view -0
  30              		.cfi_startproc
  31              		@ args = 0, pretend = 0, frame = 0
  32              		@ frame_needed = 0, uses_anonymous_args = 0
  33              		.loc 1 416 54 is_stmt 0 view .LVU1
  34 0000 08B5     		push	{r3, lr}
  35              	.LCFI0:
  36              		.cfi_def_cfa_offset 8
  37              		.cfi_offset 3, -8
  38              		.cfi_offset 14, -4
  39 0002 0346     		mov	r3, r0
 417:FML/Src/EC2x.c ****     timeout_cnt = timeout / 100;
  40              		.loc 1 417 5 is_stmt 1 view .LVU2
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 9


  41              		.loc 1 417 17 is_stmt 0 view .LVU3
  42 0004 064A     		ldr	r2, .L3
  43 0006 A2FB0121 		umull	r2, r1, r2, r1
  44              	.LVL1:
  45              		.loc 1 417 17 view .LVU4
  46 000a C1F34711 		ubfx	r1, r1, #5, #8
  47 000e 054A     		ldr	r2, .L3+4
  48 0010 1170     		strb	r1, [r2]
 418:FML/Src/EC2x.c ****     timer_insert(100,timeout_cnt,ec2x_replymatch,expect);
  49              		.loc 1 418 5 is_stmt 1 view .LVU5
  50 0012 054A     		ldr	r2, .L3+8
  51 0014 49B2     		sxtb	r1, r1
  52 0016 6420     		movs	r0, #100
  53              	.LVL2:
  54              		.loc 1 418 5 is_stmt 0 view .LVU6
  55 0018 FFF7FEFF 		bl	timer_insert
  56              	.LVL3:
 419:FML/Src/EC2x.c **** }
  57              		.loc 1 419 1 view .LVU7
  58 001c 08BD     		pop	{r3, pc}
  59              	.L4:
  60 001e 00BF     		.align	2
  61              	.L3:
  62 0020 1F85EB51 		.word	1374389535
  63 0024 00000000 		.word	.LANCHOR0
  64 0028 00000000 		.word	ec2x_replymatch
  65              		.cfi_endproc
  66              	.LFE302:
  68              		.section	.rodata.ec2x_reset.str1.4,"aMS",%progbits,1
  69              		.align	2
  70              	.LC0:
  71 0000 5244590D 		.ascii	"RDY\015\012\000"
  71      0A00
  72              		.section	.text.ec2x_reset,"ax",%progbits
  73              		.align	1
  74              		.syntax unified
  75              		.thumb
  76              		.thumb_func
  78              	ec2x_reset:
  79              	.LVL4:
  80              	.LFB292:
 142:FML/Src/EC2x.c ****     fd = 0;
  81              		.loc 1 142 23 is_stmt 1 view -0
  82              		.cfi_startproc
  83              		@ args = 0, pretend = 0, frame = 0
  84              		@ frame_needed = 0, uses_anonymous_args = 0
 142:FML/Src/EC2x.c ****     fd = 0;
  85              		.loc 1 142 23 is_stmt 0 view .LVU9
  86 0000 08B5     		push	{r3, lr}
  87              	.LCFI1:
  88              		.cfi_def_cfa_offset 8
  89              		.cfi_offset 3, -8
  90              		.cfi_offset 14, -4
 143:FML/Src/EC2x.c ****     int err_code = 0;
  91              		.loc 1 143 5 is_stmt 1 view .LVU10
  92              	.LVL5:
 144:FML/Src/EC2x.c ****     // if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 10


  93              		.loc 1 144 5 view .LVU11
 154:FML/Src/EC2x.c ****     // ATMsg_TypeDef *msg_send = (ATMsg_TypeDef *)malloc(sizeof(ATMsg_TypeDef));
  94              		.loc 1 154 5 view .LVU12
  95 0002 42F21071 		movw	r1, #10000
  96 0006 0448     		ldr	r0, .L7
  97 0008 FFF7FEFF 		bl	ec2x_waitreply
  98              	.LVL6:
 166:FML/Src/EC2x.c **** }
  99              		.loc 1 166 5 view .LVU13
 100 000c 0121     		movs	r1, #1
 101 000e 0348     		ldr	r0, .L7+4
 102 0010 FFF7FEFF 		bl	queue_insert
 103              	.LVL7:
 167:FML/Src/EC2x.c **** 
 104              		.loc 1 167 1 is_stmt 0 view .LVU14
 105 0014 08BD     		pop	{r3, pc}
 106              	.L8:
 107 0016 00BF     		.align	2
 108              	.L7:
 109 0018 00000000 		.word	.LC0
 110 001c 00000000 		.word	.LANCHOR1
 111              		.cfi_endproc
 112              	.LFE292:
 114              		.section	.text.ec2x_reply_handler,"ax",%progbits
 115              		.align	1
 116              		.global	ec2x_reply_handler
 117              		.syntax unified
 118              		.thumb
 119              		.thumb_func
 121              	ec2x_reply_handler:
 122              	.LFB299:
 351:FML/Src/EC2x.c **** 
 123              		.loc 1 351 30 is_stmt 1 view -0
 124              		.cfi_startproc
 125              		@ args = 0, pretend = 0, frame = 0
 126              		@ frame_needed = 0, uses_anonymous_args = 0
 127 0000 38B5     		push	{r3, r4, r5, lr}
 128              	.LCFI2:
 129              		.cfi_def_cfa_offset 16
 130              		.cfi_offset 3, -16
 131              		.cfi_offset 4, -12
 132              		.cfi_offset 5, -8
 133              		.cfi_offset 14, -4
 353:FML/Src/EC2x.c ****         queue_pop(&ec2x_txmsg_queue,&cur_msg,1);
 134              		.loc 1 353 5 view .LVU16
 353:FML/Src/EC2x.c ****         queue_pop(&ec2x_txmsg_queue,&cur_msg,1);
 135              		.loc 1 353 9 is_stmt 0 view .LVU17
 136 0002 1248     		ldr	r0, .L15
 137 0004 FFF7FEFF 		bl	queue_is_empty
 138              	.LVL8:
 353:FML/Src/EC2x.c ****         queue_pop(&ec2x_txmsg_queue,&cur_msg,1);
 139              		.loc 1 353 7 view .LVU18
 140 0008 20B1     		cbz	r0, .L13
 141              	.L10:
 362:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 142              		.loc 1 362 5 is_stmt 1 view .LVU19
 362:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 11


 143              		.loc 1 362 9 is_stmt 0 view .LVU20
 144 000a 1048     		ldr	r0, .L15
 145 000c FFF7FEFF 		bl	queue_is_empty
 146              	.LVL9:
 362:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 147              		.loc 1 362 7 view .LVU21
 148 0010 B8B1     		cbz	r0, .L14
 149              	.L9:
 365:FML/Src/EC2x.c **** 
 150              		.loc 1 365 1 view .LVU22
 151 0012 38BD     		pop	{r3, r4, r5, pc}
 152              	.L13:
 153              	.LBB2:
 354:FML/Src/EC2x.c ****         free(cur_msg->expect_reply);
 154              		.loc 1 354 9 is_stmt 1 view .LVU23
 155 0014 0E4C     		ldr	r4, .L15+4
 156 0016 0122     		movs	r2, #1
 157 0018 2146     		mov	r1, r4
 158 001a 0C48     		ldr	r0, .L15
 159 001c FFF7FEFF 		bl	queue_pop
 160              	.LVL10:
 355:FML/Src/EC2x.c ****         cur_msg->expect_reply = NULL;
 161              		.loc 1 355 9 view .LVU24
 355:FML/Src/EC2x.c ****         cur_msg->expect_reply = NULL;
 162              		.loc 1 355 21 is_stmt 0 view .LVU25
 163 0020 2368     		ldr	r3, [r4]
 355:FML/Src/EC2x.c ****         cur_msg->expect_reply = NULL;
 164              		.loc 1 355 9 view .LVU26
 165 0022 5868     		ldr	r0, [r3, #4]
 166 0024 FFF7FEFF 		bl	free
 167              	.LVL11:
 356:FML/Src/EC2x.c ****         free(cur_msg->txmsg);
 168              		.loc 1 356 9 is_stmt 1 view .LVU27
 356:FML/Src/EC2x.c ****         free(cur_msg->txmsg);
 169              		.loc 1 356 16 is_stmt 0 view .LVU28
 170 0028 2368     		ldr	r3, [r4]
 356:FML/Src/EC2x.c ****         free(cur_msg->txmsg);
 171              		.loc 1 356 31 view .LVU29
 172 002a 0025     		movs	r5, #0
 173 002c 5D60     		str	r5, [r3, #4]
 357:FML/Src/EC2x.c ****         cur_msg->txmsg = NULL;
 174              		.loc 1 357 9 is_stmt 1 view .LVU30
 175 002e 1868     		ldr	r0, [r3]
 176 0030 FFF7FEFF 		bl	free
 177              	.LVL12:
 358:FML/Src/EC2x.c ****         free(cur_msg);
 178              		.loc 1 358 9 view .LVU31
 358:FML/Src/EC2x.c ****         free(cur_msg);
 179              		.loc 1 358 16 is_stmt 0 view .LVU32
 180 0034 2368     		ldr	r3, [r4]
 358:FML/Src/EC2x.c ****         free(cur_msg);
 181              		.loc 1 358 24 view .LVU33
 182 0036 1D60     		str	r5, [r3]
 359:FML/Src/EC2x.c ****         cur_msg = NULL;
 183              		.loc 1 359 9 is_stmt 1 view .LVU34
 184 0038 2068     		ldr	r0, [r4]
 185 003a FFF7FEFF 		bl	free
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 12


 186              	.LVL13:
 360:FML/Src/EC2x.c ****     }
 187              		.loc 1 360 9 view .LVU35
 360:FML/Src/EC2x.c ****     }
 188              		.loc 1 360 17 is_stmt 0 view .LVU36
 189 003e 2560     		str	r5, [r4]
 190 0040 E3E7     		b	.L10
 191              	.L14:
 192              	.LBE2:
 363:FML/Src/EC2x.c ****     }        
 193              		.loc 1 363 9 is_stmt 1 view .LVU37
 194 0042 0321     		movs	r1, #3
 195 0044 0348     		ldr	r0, .L15+8
 196 0046 FFF7FEFF 		bl	queue_insert
 197              	.LVL14:
 365:FML/Src/EC2x.c **** 
 198              		.loc 1 365 1 is_stmt 0 view .LVU38
 199 004a E2E7     		b	.L9
 200              	.L16:
 201              		.align	2
 202              	.L15:
 203 004c 00000000 		.word	.LANCHOR2
 204 0050 00000000 		.word	.LANCHOR3
 205 0054 00000000 		.word	.LANCHOR1
 206              		.cfi_endproc
 207              	.LFE299:
 209              		.section	.text.ex2x_timeout_handler,"ax",%progbits
 210              		.align	1
 211              		.global	ex2x_timeout_handler
 212              		.syntax unified
 213              		.thumb
 214              		.thumb_func
 216              	ex2x_timeout_handler:
 217              	.LFB300:
 373:FML/Src/EC2x.c ****     cur_msg->retry_times--;
 218              		.loc 1 373 32 is_stmt 1 view -0
 219              		.cfi_startproc
 220              		@ args = 0, pretend = 0, frame = 0
 221              		@ frame_needed = 0, uses_anonymous_args = 0
 222 0000 38B5     		push	{r3, r4, r5, lr}
 223              	.LCFI3:
 224              		.cfi_def_cfa_offset 16
 225              		.cfi_offset 3, -16
 226              		.cfi_offset 4, -12
 227              		.cfi_offset 5, -8
 228              		.cfi_offset 14, -4
 374:FML/Src/EC2x.c ****     if(cur_msg->retry_times == 0){
 229              		.loc 1 374 5 view .LVU40
 374:FML/Src/EC2x.c ****     if(cur_msg->retry_times == 0){
 230              		.loc 1 374 12 is_stmt 0 view .LVU41
 231 0002 134B     		ldr	r3, .L21
 232 0004 1A68     		ldr	r2, [r3]
 233 0006 937A     		ldrb	r3, [r2, #10]	@ zero_extendqisi2
 374:FML/Src/EC2x.c ****     if(cur_msg->retry_times == 0){
 234              		.loc 1 374 25 view .LVU42
 235 0008 013B     		subs	r3, r3, #1
 236 000a DBB2     		uxtb	r3, r3
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 13


 237 000c 9372     		strb	r3, [r2, #10]
 375:FML/Src/EC2x.c ****         if(!queue_is_empty(&ec2x_txmsg_queue)){
 238              		.loc 1 375 5 is_stmt 1 view .LVU43
 375:FML/Src/EC2x.c ****         if(!queue_is_empty(&ec2x_txmsg_queue)){
 239              		.loc 1 375 7 is_stmt 0 view .LVU44
 240 000e D3B9     		cbnz	r3, .L18
 376:FML/Src/EC2x.c ****             queue_pop(&ec2x_txmsg_queue,&cur_msg,1); 
 241              		.loc 1 376 9 is_stmt 1 view .LVU45
 376:FML/Src/EC2x.c ****             queue_pop(&ec2x_txmsg_queue,&cur_msg,1); 
 242              		.loc 1 376 13 is_stmt 0 view .LVU46
 243 0010 1048     		ldr	r0, .L21+4
 244 0012 FFF7FEFF 		bl	queue_is_empty
 245              	.LVL15:
 376:FML/Src/EC2x.c ****             queue_pop(&ec2x_txmsg_queue,&cur_msg,1); 
 246              		.loc 1 376 11 view .LVU47
 247 0016 D0B9     		cbnz	r0, .L17
 248              	.LBB3:
 377:FML/Src/EC2x.c ****             free(cur_msg->expect_reply);
 249              		.loc 1 377 13 is_stmt 1 view .LVU48
 250 0018 0D4C     		ldr	r4, .L21
 251 001a 0122     		movs	r2, #1
 252 001c 2146     		mov	r1, r4
 253 001e 0D48     		ldr	r0, .L21+4
 254 0020 FFF7FEFF 		bl	queue_pop
 255              	.LVL16:
 378:FML/Src/EC2x.c ****             cur_msg->expect_reply = NULL;
 256              		.loc 1 378 13 view .LVU49
 378:FML/Src/EC2x.c ****             cur_msg->expect_reply = NULL;
 257              		.loc 1 378 25 is_stmt 0 view .LVU50
 258 0024 2368     		ldr	r3, [r4]
 378:FML/Src/EC2x.c ****             cur_msg->expect_reply = NULL;
 259              		.loc 1 378 13 view .LVU51
 260 0026 5868     		ldr	r0, [r3, #4]
 261 0028 FFF7FEFF 		bl	free
 262              	.LVL17:
 379:FML/Src/EC2x.c ****             free(cur_msg->txmsg);
 263              		.loc 1 379 13 is_stmt 1 view .LVU52
 379:FML/Src/EC2x.c ****             free(cur_msg->txmsg);
 264              		.loc 1 379 20 is_stmt 0 view .LVU53
 265 002c 2368     		ldr	r3, [r4]
 379:FML/Src/EC2x.c ****             free(cur_msg->txmsg);
 266              		.loc 1 379 35 view .LVU54
 267 002e 0025     		movs	r5, #0
 268 0030 5D60     		str	r5, [r3, #4]
 380:FML/Src/EC2x.c ****             cur_msg->txmsg = NULL;
 269              		.loc 1 380 13 is_stmt 1 view .LVU55
 270 0032 1868     		ldr	r0, [r3]
 271 0034 FFF7FEFF 		bl	free
 272              	.LVL18:
 381:FML/Src/EC2x.c ****             free(cur_msg);
 273              		.loc 1 381 13 view .LVU56
 381:FML/Src/EC2x.c ****             free(cur_msg);
 274              		.loc 1 381 20 is_stmt 0 view .LVU57
 275 0038 2368     		ldr	r3, [r4]
 381:FML/Src/EC2x.c ****             free(cur_msg);
 276              		.loc 1 381 28 view .LVU58
 277 003a 1D60     		str	r5, [r3]
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 14


 382:FML/Src/EC2x.c ****             cur_msg = NULL; 
 278              		.loc 1 382 13 is_stmt 1 view .LVU59
 279 003c 2068     		ldr	r0, [r4]
 280 003e FFF7FEFF 		bl	free
 281              	.LVL19:
 383:FML/Src/EC2x.c ****         }     
 282              		.loc 1 383 13 view .LVU60
 383:FML/Src/EC2x.c ****         }     
 283              		.loc 1 383 21 is_stmt 0 view .LVU61
 284 0042 2560     		str	r5, [r4]
 285 0044 03E0     		b	.L17
 286              	.L18:
 287              	.LBE3:
 387:FML/Src/EC2x.c **** }
 288              		.loc 1 387 9 is_stmt 1 view .LVU62
 289 0046 0321     		movs	r1, #3
 290 0048 0348     		ldr	r0, .L21+8
 291 004a FFF7FEFF 		bl	queue_insert
 292              	.LVL20:
 293              	.L17:
 388:FML/Src/EC2x.c **** 
 294              		.loc 1 388 1 is_stmt 0 view .LVU63
 295 004e 38BD     		pop	{r3, r4, r5, pc}
 296              	.L22:
 297              		.align	2
 298              	.L21:
 299 0050 00000000 		.word	.LANCHOR3
 300 0054 00000000 		.word	.LANCHOR2
 301 0058 00000000 		.word	.LANCHOR1
 302              		.cfi_endproc
 303              	.LFE300:
 305              		.section	.text.ec2x_io_init,"ax",%progbits
 306              		.align	1
 307              		.global	ec2x_io_init
 308              		.syntax unified
 309              		.thumb
 310              		.thumb_func
 312              	ec2x_io_init:
 313              	.LVL21:
 314              	.LFB291:
 102:FML/Src/EC2x.c ****      GPIO_InitTypeDef GPIO_InitStruct = {0};
 315              		.loc 1 102 1 is_stmt 1 view -0
 316              		.cfi_startproc
 317              		@ args = 0, pretend = 0, frame = 24
 318              		@ frame_needed = 0, uses_anonymous_args = 0
 102:FML/Src/EC2x.c ****      GPIO_InitTypeDef GPIO_InitStruct = {0};
 319              		.loc 1 102 1 is_stmt 0 view .LVU65
 320 0000 70B5     		push	{r4, r5, r6, lr}
 321              	.LCFI4:
 322              		.cfi_def_cfa_offset 16
 323              		.cfi_offset 4, -16
 324              		.cfi_offset 5, -12
 325              		.cfi_offset 6, -8
 326              		.cfi_offset 14, -4
 327 0002 86B0     		sub	sp, sp, #24
 328              	.LCFI5:
 329              		.cfi_def_cfa_offset 40
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 15


 330 0004 0446     		mov	r4, r0
 103:FML/Src/EC2x.c ****     
 331              		.loc 1 103 6 is_stmt 1 view .LVU66
 103:FML/Src/EC2x.c ****     
 332              		.loc 1 103 23 is_stmt 0 view .LVU67
 333 0006 0025     		movs	r5, #0
 334 0008 0195     		str	r5, [sp, #4]
 335 000a 0295     		str	r5, [sp, #8]
 336 000c 0395     		str	r5, [sp, #12]
 337 000e 0495     		str	r5, [sp, #16]
 338 0010 0595     		str	r5, [sp, #20]
 107:FML/Src/EC2x.c ****     
 339              		.loc 1 107 5 is_stmt 1 view .LVU68
 340              	.LBB4:
 107:FML/Src/EC2x.c ****     
 341              		.loc 1 107 5 view .LVU69
 107:FML/Src/EC2x.c ****     
 342              		.loc 1 107 5 view .LVU70
 343 0012 1F4B     		ldr	r3, .L25
 344 0014 DA6C     		ldr	r2, [r3, #76]
 345 0016 42F00102 		orr	r2, r2, #1
 346 001a DA64     		str	r2, [r3, #76]
 107:FML/Src/EC2x.c ****     
 347              		.loc 1 107 5 view .LVU71
 348 001c DB6C     		ldr	r3, [r3, #76]
 349 001e 03F00103 		and	r3, r3, #1
 350 0022 0093     		str	r3, [sp]
 107:FML/Src/EC2x.c ****     
 351              		.loc 1 107 5 view .LVU72
 352 0024 009B     		ldr	r3, [sp]
 353              	.LBE4:
 107:FML/Src/EC2x.c ****     
 354              		.loc 1 107 5 view .LVU73
 110:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 355              		.loc 1 110 5 view .LVU74
 110:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 356              		.loc 1 110 33 is_stmt 0 view .LVU75
 357 0026 038C     		ldrh	r3, [r0, #32]
 110:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 358              		.loc 1 110 25 view .LVU76
 359 0028 0193     		str	r3, [sp, #4]
 111:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 360              		.loc 1 111 5 is_stmt 1 view .LVU77
 111:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 361              		.loc 1 111 26 is_stmt 0 view .LVU78
 362 002a 0126     		movs	r6, #1
 363 002c 0296     		str	r6, [sp, #8]
 112:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 364              		.loc 1 112 5 is_stmt 1 view .LVU79
 113:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->reset_port, &GPIO_InitStruct);
 365              		.loc 1 113 5 view .LVU80
 114:FML/Src/EC2x.c **** 
 366              		.loc 1 114 5 view .LVU81
 367 002e 01A9     		add	r1, sp, #4
 368 0030 C069     		ldr	r0, [r0, #28]
 369              	.LVL22:
 114:FML/Src/EC2x.c **** 
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 16


 370              		.loc 1 114 5 is_stmt 0 view .LVU82
 371 0032 FFF7FEFF 		bl	HAL_GPIO_Init
 372              	.LVL23:
 116:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 373              		.loc 1 116 5 is_stmt 1 view .LVU83
 116:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 374              		.loc 1 116 33 is_stmt 0 view .LVU84
 375 0036 238D     		ldrh	r3, [r4, #40]
 116:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 376              		.loc 1 116 25 view .LVU85
 377 0038 0193     		str	r3, [sp, #4]
 117:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 378              		.loc 1 117 5 is_stmt 1 view .LVU86
 117:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 379              		.loc 1 117 26 is_stmt 0 view .LVU87
 380 003a 0296     		str	r6, [sp, #8]
 118:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 381              		.loc 1 118 5 is_stmt 1 view .LVU88
 118:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 382              		.loc 1 118 26 is_stmt 0 view .LVU89
 383 003c 0395     		str	r5, [sp, #12]
 119:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->wake_port, &GPIO_InitStruct);
 384              		.loc 1 119 5 is_stmt 1 view .LVU90
 119:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->wake_port, &GPIO_InitStruct);
 385              		.loc 1 119 27 is_stmt 0 view .LVU91
 386 003e 0495     		str	r5, [sp, #16]
 120:FML/Src/EC2x.c **** 
 387              		.loc 1 120 5 is_stmt 1 view .LVU92
 388 0040 01A9     		add	r1, sp, #4
 389 0042 606A     		ldr	r0, [r4, #36]
 390 0044 FFF7FEFF 		bl	HAL_GPIO_Init
 391              	.LVL24:
 122:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 392              		.loc 1 122 5 view .LVU93
 122:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 393              		.loc 1 122 33 is_stmt 0 view .LVU94
 394 0048 238B     		ldrh	r3, [r4, #24]
 122:FML/Src/EC2x.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
 395              		.loc 1 122 25 view .LVU95
 396 004a 0193     		str	r3, [sp, #4]
 123:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 397              		.loc 1 123 5 is_stmt 1 view .LVU96
 123:FML/Src/EC2x.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
 398              		.loc 1 123 26 is_stmt 0 view .LVU97
 399 004c 0296     		str	r6, [sp, #8]
 124:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 400              		.loc 1 124 5 is_stmt 1 view .LVU98
 124:FML/Src/EC2x.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
 401              		.loc 1 124 26 is_stmt 0 view .LVU99
 402 004e 0395     		str	r5, [sp, #12]
 125:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->pwren_port, &GPIO_InitStruct);
 403              		.loc 1 125 5 is_stmt 1 view .LVU100
 125:FML/Src/EC2x.c ****     HAL_GPIO_Init(device->pwren_port, &GPIO_InitStruct);
 404              		.loc 1 125 27 is_stmt 0 view .LVU101
 405 0050 0495     		str	r5, [sp, #16]
 126:FML/Src/EC2x.c ****     
 406              		.loc 1 126 5 is_stmt 1 view .LVU102
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 17


 407 0052 01A9     		add	r1, sp, #4
 408 0054 6069     		ldr	r0, [r4, #20]
 409 0056 FFF7FEFF 		bl	HAL_GPIO_Init
 410              	.LVL25:
 130:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->wake_port, device->wake_pin, GPIO_PIN_SET);
 411              		.loc 1 130 5 view .LVU103
 412 005a 3246     		mov	r2, r6
 413 005c 218C     		ldrh	r1, [r4, #32]
 414 005e E069     		ldr	r0, [r4, #28]
 415 0060 FFF7FEFF 		bl	HAL_GPIO_WritePin
 416              	.LVL26:
 131:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_SET);
 417              		.loc 1 131 5 view .LVU104
 418 0064 3246     		mov	r2, r6
 419 0066 218D     		ldrh	r1, [r4, #40]
 420 0068 606A     		ldr	r0, [r4, #36]
 421 006a FFF7FEFF 		bl	HAL_GPIO_WritePin
 422              	.LVL27:
 132:FML/Src/EC2x.c ****     HAL_Delay(1000);
 423              		.loc 1 132 5 view .LVU105
 424 006e 3246     		mov	r2, r6
 425 0070 218B     		ldrh	r1, [r4, #24]
 426 0072 6069     		ldr	r0, [r4, #20]
 427 0074 FFF7FEFF 		bl	HAL_GPIO_WritePin
 428              	.LVL28:
 133:FML/Src/EC2x.c ****     HAL_GPIO_WritePin(device->pwren_port, device->pwren_pin, GPIO_PIN_RESET);
 429              		.loc 1 133 5 view .LVU106
 430 0078 4FF47A70 		mov	r0, #1000
 431 007c FFF7FEFF 		bl	HAL_Delay
 432              	.LVL29:
 134:FML/Src/EC2x.c **** }
 433              		.loc 1 134 5 view .LVU107
 434 0080 2A46     		mov	r2, r5
 435 0082 218B     		ldrh	r1, [r4, #24]
 436 0084 6069     		ldr	r0, [r4, #20]
 437 0086 FFF7FEFF 		bl	HAL_GPIO_WritePin
 438              	.LVL30:
 135:FML/Src/EC2x.c **** /**
 439              		.loc 1 135 1 is_stmt 0 view .LVU108
 440 008a 06B0     		add	sp, sp, #24
 441              	.LCFI6:
 442              		.cfi_def_cfa_offset 16
 443              		@ sp needed
 444 008c 70BD     		pop	{r4, r5, r6, pc}
 445              	.LVL31:
 446              	.L26:
 135:FML/Src/EC2x.c **** /**
 447              		.loc 1 135 1 view .LVU109
 448 008e 00BF     		.align	2
 449              	.L25:
 450 0090 00100240 		.word	1073876992
 451              		.cfi_endproc
 452              	.LFE291:
 454              		.section	.text.ec2x_open,"ax",%progbits
 455              		.align	1
 456              		.global	ec2x_open
 457              		.syntax unified
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 18


 458              		.thumb
 459              		.thumb_func
 461              	ec2x_open:
 462              	.LVL32:
 463              	.LFB293:
 177:FML/Src/EC2x.c ****     uint8_t i = 0;
 464              		.loc 1 177 1 is_stmt 1 view -0
 465              		.cfi_startproc
 466              		@ args = 0, pretend = 0, frame = 0
 467              		@ frame_needed = 0, uses_anonymous_args = 0
 177:FML/Src/EC2x.c ****     uint8_t i = 0;
 468              		.loc 1 177 1 is_stmt 0 view .LVU111
 469 0000 70B5     		push	{r4, r5, r6, lr}
 470              	.LCFI7:
 471              		.cfi_def_cfa_offset 16
 472              		.cfi_offset 4, -16
 473              		.cfi_offset 5, -12
 474              		.cfi_offset 6, -8
 475              		.cfi_offset 14, -4
 476 0002 0546     		mov	r5, r0
 178:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 477              		.loc 1 178 5 is_stmt 1 view .LVU112
 478              	.LVL33:
 179:FML/Src/EC2x.c ****     {
 479              		.loc 1 179 5 view .LVU113
 179:FML/Src/EC2x.c ****     {
 480              		.loc 1 179 11 is_stmt 0 view .LVU114
 481 0004 0024     		movs	r4, #0
 482              	.LVL34:
 483              	.L28:
 179:FML/Src/EC2x.c ****     {
 484              		.loc 1 179 15 is_stmt 1 discriminator 1 view .LVU115
 179:FML/Src/EC2x.c ****     {
 485              		.loc 1 179 5 is_stmt 0 discriminator 1 view .LVU116
 486 0006 1CB1     		cbz	r4, .L31
 195:FML/Src/EC2x.c **** };
 487              		.loc 1 195 12 view .LVU117
 488 0008 4FF0FF36 		mov	r6, #-1
 489              	.LVL35:
 490              	.L27:
 196:FML/Src/EC2x.c **** 
 491              		.loc 1 196 1 view .LVU118
 492 000c 3046     		mov	r0, r6
 493 000e 70BD     		pop	{r4, r5, r6, pc}
 494              	.LVL36:
 495              	.L31:
 181:FML/Src/EC2x.c ****         {
 496              		.loc 1 181 9 is_stmt 1 view .LVU119
 497              	.LBB5:
 181:FML/Src/EC2x.c ****         {
 498              		.loc 1 181 39 is_stmt 0 view .LVU120
 499 0010 2646     		mov	r6, r4
 500 0012 C4EB0413 		rsb	r3, r4, r4, lsl #4
 181:FML/Src/EC2x.c ****         {
 501              		.loc 1 181 12 view .LVU121
 502 0016 1349     		ldr	r1, .L34
 503 0018 01EB8301 		add	r1, r1, r3, lsl #2
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 19


 504 001c 2846     		mov	r0, r5
 505 001e FFF7FEFF 		bl	strcmp
 506              	.LVL37:
 181:FML/Src/EC2x.c ****         {
 507              		.loc 1 181 11 view .LVU122
 508 0022 10B1     		cbz	r0, .L33
 509              	.LBE5:
 179:FML/Src/EC2x.c ****     {
 510              		.loc 1 179 64 is_stmt 1 discriminator 2 view .LVU123
 179:FML/Src/EC2x.c ****     {
 511              		.loc 1 179 65 is_stmt 0 discriminator 2 view .LVU124
 512 0024 0134     		adds	r4, r4, #1
 513              	.LVL38:
 179:FML/Src/EC2x.c ****     {
 514              		.loc 1 179 65 discriminator 2 view .LVU125
 515 0026 E4B2     		uxtb	r4, r4
 516              	.LVL39:
 179:FML/Src/EC2x.c ****     {
 517              		.loc 1 179 65 discriminator 2 view .LVU126
 518 0028 EDE7     		b	.L28
 519              	.L33:
 520              	.LBB7:
 521              	.LBB6:
 183:FML/Src/EC2x.c **** 
 522              		.loc 1 183 13 is_stmt 1 view .LVU127
 523 002a C4EB0413 		rsb	r3, r4, r4, lsl #4
 524 002e 0D48     		ldr	r0, .L34
 525 0030 00EB8300 		add	r0, r0, r3, lsl #2
 526 0034 FFF7FEFF 		bl	ec2x_io_init
 527              	.LVL40:
 185:FML/Src/EC2x.c ****             queue_init(&ec2x_txmsg_queue,ec2x_txmsg_buff,5);
 528              		.loc 1 185 13 view .LVU128
 529 0038 0B4C     		ldr	r4, .L34+4
 530              	.LVL41:
 185:FML/Src/EC2x.c ****             queue_init(&ec2x_txmsg_queue,ec2x_txmsg_buff,5);
 531              		.loc 1 185 13 is_stmt 0 view .LVU129
 532 003a 0A22     		movs	r2, #10
 533 003c 0B49     		ldr	r1, .L34+8
 534 003e 2046     		mov	r0, r4
 535 0040 FFF7FEFF 		bl	queue_init
 536              	.LVL42:
 186:FML/Src/EC2x.c ****         
 537              		.loc 1 186 13 is_stmt 1 view .LVU130
 538 0044 0522     		movs	r2, #5
 539 0046 0A49     		ldr	r1, .L34+12
 540 0048 0A48     		ldr	r0, .L34+16
 541 004a FFF7FEFF 		bl	queue_init
 542              	.LVL43:
 189:FML/Src/EC2x.c ****             FSM_Regist(&ec2x_fsm,ec2x_transtable,num,UINIT);
 543              		.loc 1 189 13 view .LVU131
 190:FML/Src/EC2x.c ****             queue_insert(&ec2x_event_queue,(uint8_t)Timeout_Event);
 544              		.loc 1 190 13 view .LVU132
 545 004e 0023     		movs	r3, #0
 546 0050 0622     		movs	r2, #6
 547 0052 0949     		ldr	r1, .L34+20
 548 0054 0948     		ldr	r0, .L34+24
 549 0056 FFF7FEFF 		bl	FSM_Regist
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 20


 550              	.LVL44:
 191:FML/Src/EC2x.c ****             return i;
 551              		.loc 1 191 13 view .LVU133
 552 005a 0121     		movs	r1, #1
 553 005c 2046     		mov	r0, r4
 554 005e FFF7FEFF 		bl	queue_insert
 555              	.LVL45:
 192:FML/Src/EC2x.c ****         }
 556              		.loc 1 192 13 view .LVU134
 192:FML/Src/EC2x.c ****         }
 557              		.loc 1 192 20 is_stmt 0 view .LVU135
 558 0062 D3E7     		b	.L27
 559              	.L35:
 560              		.align	2
 561              	.L34:
 562 0064 00000000 		.word	.LANCHOR4
 563 0068 00000000 		.word	.LANCHOR1
 564 006c 00000000 		.word	.LANCHOR5
 565 0070 00000000 		.word	.LANCHOR6
 566 0074 00000000 		.word	.LANCHOR2
 567 0078 00000000 		.word	.LANCHOR7
 568 007c 00000000 		.word	.LANCHOR8
 569              	.LBE6:
 570              	.LBE7:
 571              		.cfi_endproc
 572              	.LFE293:
 574              		.section	.text.ec2x_write,"ax",%progbits
 575              		.align	1
 576              		.global	ec2x_write
 577              		.syntax unified
 578              		.thumb
 579              		.thumb_func
 581              	ec2x_write:
 582              	.LVL46:
 583              	.LFB294:
 218:FML/Src/EC2x.c ****     int err_code = 0;
 584              		.loc 1 218 53 is_stmt 1 view -0
 585              		.cfi_startproc
 586              		@ args = 0, pretend = 0, frame = 0
 587              		@ frame_needed = 0, uses_anonymous_args = 0
 219:FML/Src/EC2x.c ****     if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
 588              		.loc 1 219 5 view .LVU137
 220:FML/Src/EC2x.c ****         return (err_code = -1);
 589              		.loc 1 220 5 view .LVU138
 220:FML/Src/EC2x.c ****         return (err_code = -1);
 590              		.loc 1 220 7 is_stmt 0 view .LVU139
 591 0000 10B1     		cbz	r0, .L43
 221:FML/Src/EC2x.c ****     else{
 592              		.loc 1 221 26 view .LVU140
 593 0002 4FF0FF30 		mov	r0, #-1
 594              	.LVL47:
 226:FML/Src/EC2x.c **** /**
 595              		.loc 1 226 1 view .LVU141
 596 0006 7047     		bx	lr
 597              	.LVL48:
 598              	.L43:
 218:FML/Src/EC2x.c ****     int err_code = 0;
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 21


 599              		.loc 1 218 53 view .LVU142
 600 0008 08B5     		push	{r3, lr}
 601              	.LCFI8:
 602              		.cfi_def_cfa_offset 8
 603              		.cfi_offset 3, -8
 604              		.cfi_offset 14, -4
 223:FML/Src/EC2x.c ****         return(!err_code);
 605              		.loc 1 223 9 is_stmt 1 view .LVU143
 223:FML/Src/EC2x.c ****         return(!err_code);
 606              		.loc 1 223 21 is_stmt 0 view .LVU144
 607 000a C0EB0013 		rsb	r3, r0, r0, lsl #4
 608 000e 0548     		ldr	r0, .L44
 609              	.LVL49:
 223:FML/Src/EC2x.c ****         return(!err_code);
 610              		.loc 1 223 21 view .LVU145
 611 0010 00EB8303 		add	r3, r0, r3, lsl #2
 612 0014 1869     		ldr	r0, [r3, #16]
 613 0016 FFF7FEFF 		bl	HAL_UART_Transmit_IT
 614              	.LVL50:
 224:FML/Src/EC2x.c ****     }
 615              		.loc 1 224 9 is_stmt 1 view .LVU146
 224:FML/Src/EC2x.c ****     }
 616              		.loc 1 224 16 is_stmt 0 view .LVU147
 617 001a B0FA80F0 		clz	r0, r0
 618              	.LVL51:
 224:FML/Src/EC2x.c ****     }
 619              		.loc 1 224 16 view .LVU148
 620 001e 4009     		lsrs	r0, r0, #5
 226:FML/Src/EC2x.c **** /**
 621              		.loc 1 226 1 view .LVU149
 622 0020 08BD     		pop	{r3, pc}
 623              	.L45:
 624 0022 00BF     		.align	2
 625              	.L44:
 626 0024 00000000 		.word	.LANCHOR4
 627              		.cfi_endproc
 628              	.LFE294:
 630              		.section	.text.ec2x_cmd_send,"ax",%progbits
 631              		.align	1
 632              		.syntax unified
 633              		.thumb
 634              		.thumb_func
 636              	ec2x_cmd_send:
 637              	.LVL52:
 638              	.LFB301:
 401:FML/Src/EC2x.c ****     if(tx_buff !=NULL)
 639              		.loc 1 401 1 is_stmt 1 view -0
 640              		.cfi_startproc
 641              		@ args = 4, pretend = 0, frame = 0
 642              		@ frame_needed = 0, uses_anonymous_args = 0
 401:FML/Src/EC2x.c ****     if(tx_buff !=NULL)
 643              		.loc 1 401 1 is_stmt 0 view .LVU151
 644 0000 10B5     		push	{r4, lr}
 645              	.LCFI9:
 646              		.cfi_def_cfa_offset 8
 647              		.cfi_offset 4, -8
 648              		.cfi_offset 14, -4
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 22


 649 0002 1C46     		mov	r4, r3
 402:FML/Src/EC2x.c ****         ec2x_write(fd,tx_buff,len);
 650              		.loc 1 402 5 is_stmt 1 view .LVU152
 402:FML/Src/EC2x.c ****         ec2x_write(fd,tx_buff,len);
 651              		.loc 1 402 7 is_stmt 0 view .LVU153
 652 0004 09B1     		cbz	r1, .L47
 403:FML/Src/EC2x.c ****     ec2x_waitreply(expect_reply,timeout);
 653              		.loc 1 403 9 is_stmt 1 view .LVU154
 654 0006 FFF7FEFF 		bl	ec2x_write
 655              	.LVL53:
 656              	.L47:
 404:FML/Src/EC2x.c **** }
 657              		.loc 1 404 5 view .LVU155
 658 000a BDF80810 		ldrh	r1, [sp, #8]
 659 000e 2046     		mov	r0, r4
 660 0010 FFF7FEFF 		bl	ec2x_waitreply
 661              	.LVL54:
 405:FML/Src/EC2x.c **** 
 662              		.loc 1 405 1 is_stmt 0 view .LVU156
 663 0014 10BD     		pop	{r4, pc}
 405:FML/Src/EC2x.c **** 
 664              		.loc 1 405 1 view .LVU157
 665              		.cfi_endproc
 666              	.LFE301:
 668              		.section	.text.ec2x_queue_send,"ax",%progbits
 669              		.align	1
 670              		.global	ec2x_queue_send
 671              		.syntax unified
 672              		.thumb
 673              		.thumb_func
 675              	ec2x_queue_send:
 676              	.LFB298:
 337:FML/Src/EC2x.c ****     
 677              		.loc 1 337 27 is_stmt 1 view -0
 678              		.cfi_startproc
 679              		@ args = 0, pretend = 0, frame = 0
 680              		@ frame_needed = 0, uses_anonymous_args = 0
 681 0000 00B5     		push	{lr}
 682              	.LCFI10:
 683              		.cfi_def_cfa_offset 4
 684              		.cfi_offset 14, -4
 685 0002 83B0     		sub	sp, sp, #12
 686              	.LCFI11:
 687              		.cfi_def_cfa_offset 16
 339:FML/Src/EC2x.c ****         if(queue_pull(&ec2x_txmsg_queue,&cur_msg,1))
 688              		.loc 1 339 5 view .LVU159
 339:FML/Src/EC2x.c ****         if(queue_pull(&ec2x_txmsg_queue,&cur_msg,1))
 689              		.loc 1 339 9 is_stmt 0 view .LVU160
 690 0004 0C48     		ldr	r0, .L53
 691 0006 FFF7FEFF 		bl	queue_is_empty
 692              	.LVL55:
 339:FML/Src/EC2x.c ****         if(queue_pull(&ec2x_txmsg_queue,&cur_msg,1))
 693              		.loc 1 339 7 view .LVU161
 694 000a 10B1     		cbz	r0, .L52
 695              	.L49:
 343:FML/Src/EC2x.c **** 
 696              		.loc 1 343 1 view .LVU162
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 23


 697 000c 03B0     		add	sp, sp, #12
 698              	.LCFI12:
 699              		.cfi_remember_state
 700              		.cfi_def_cfa_offset 4
 701              		@ sp needed
 702 000e 5DF804FB 		ldr	pc, [sp], #4
 703              	.L52:
 704              	.LCFI13:
 705              		.cfi_restore_state
 340:FML/Src/EC2x.c ****             ec2x_cmd_send(0,cur_msg->txmsg,sizeof(cur_msg->txmsg),cur_msg->expect_reply,cur_msg->ti
 706              		.loc 1 340 9 is_stmt 1 view .LVU163
 340:FML/Src/EC2x.c ****             ec2x_cmd_send(0,cur_msg->txmsg,sizeof(cur_msg->txmsg),cur_msg->expect_reply,cur_msg->ti
 707              		.loc 1 340 12 is_stmt 0 view .LVU164
 708 0012 0122     		movs	r2, #1
 709 0014 0949     		ldr	r1, .L53+4
 710 0016 0848     		ldr	r0, .L53
 711 0018 FFF7FEFF 		bl	queue_pull
 712              	.LVL56:
 340:FML/Src/EC2x.c ****             ec2x_cmd_send(0,cur_msg->txmsg,sizeof(cur_msg->txmsg),cur_msg->expect_reply,cur_msg->ti
 713              		.loc 1 340 11 view .LVU165
 714 001c 0028     		cmp	r0, #0
 715 001e F5D0     		beq	.L49
 341:FML/Src/EC2x.c ****     }      
 716              		.loc 1 341 13 is_stmt 1 view .LVU166
 341:FML/Src/EC2x.c ****     }      
 717              		.loc 1 341 36 is_stmt 0 view .LVU167
 718 0020 064B     		ldr	r3, .L53+4
 719 0022 1A68     		ldr	r2, [r3]
 341:FML/Src/EC2x.c ****     }      
 720              		.loc 1 341 13 view .LVU168
 721 0024 5368     		ldr	r3, [r2, #4]
 722 0026 1168     		ldr	r1, [r2]
 723 0028 1289     		ldrh	r2, [r2, #8]
 724 002a 0092     		str	r2, [sp]
 725 002c 0422     		movs	r2, #4
 726 002e 0020     		movs	r0, #0
 727 0030 FFF7FEFF 		bl	ec2x_cmd_send
 728              	.LVL57:
 343:FML/Src/EC2x.c **** 
 729              		.loc 1 343 1 view .LVU169
 730 0034 EAE7     		b	.L49
 731              	.L54:
 732 0036 00BF     		.align	2
 733              	.L53:
 734 0038 00000000 		.word	.LANCHOR2
 735 003c 00000000 		.word	.LANCHOR3
 736              		.cfi_endproc
 737              	.LFE298:
 739              		.section	.text.ec2x_read,"ax",%progbits
 740              		.align	1
 741              		.global	ec2x_read
 742              		.syntax unified
 743              		.thumb
 744              		.thumb_func
 746              	ec2x_read:
 747              	.LVL58:
 748              	.LFB295:
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 24


 239:FML/Src/EC2x.c ****     uint8_t *dest = rx_buff;
 749              		.loc 1 239 52 is_stmt 1 view -0
 750              		.cfi_startproc
 751              		@ args = 0, pretend = 0, frame = 0
 752              		@ frame_needed = 0, uses_anonymous_args = 0
 240:FML/Src/EC2x.c ****     if(fd >= sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef))
 753              		.loc 1 240 5 view .LVU171
 241:FML/Src/EC2x.c ****         return -1;
 754              		.loc 1 241 5 view .LVU172
 241:FML/Src/EC2x.c ****         return -1;
 755              		.loc 1 241 7 is_stmt 0 view .LVU173
 756 0000 0028     		cmp	r0, #0
 757 0002 4BD1     		bne	.L62
 239:FML/Src/EC2x.c ****     uint8_t *dest = rx_buff;
 758              		.loc 1 239 52 view .LVU174
 759 0004 38B5     		push	{r3, r4, r5, lr}
 760              	.LCFI14:
 761              		.cfi_def_cfa_offset 16
 762              		.cfi_offset 3, -16
 763              		.cfi_offset 4, -12
 764              		.cfi_offset 5, -8
 765              		.cfi_offset 14, -4
 766 0006 1546     		mov	r5, r2
 767 0008 0446     		mov	r4, r0
 768              	.LBB8:
 244:FML/Src/EC2x.c ****         
 769              		.loc 1 244 9 is_stmt 1 view .LVU175
 770              	.LVL59:
 246:FML/Src/EC2x.c ****         //如果队列被上锁了，则等待100ms
 771              		.loc 1 246 9 view .LVU176
 248:FML/Src/EC2x.c ****         {
 772              		.loc 1 248 9 view .LVU177
 248:FML/Src/EC2x.c ****         {
 773              		.loc 1 248 15 is_stmt 0 view .LVU178
 774 000a C0EB0013 		rsb	r3, r0, r0, lsl #4
 775 000e 264A     		ldr	r2, .L69
 776              	.LVL60:
 248:FML/Src/EC2x.c ****         {
 777              		.loc 1 248 15 view .LVU179
 778 0010 02EB8303 		add	r3, r2, r3, lsl #2
 779 0014 93F82C30 		ldrb	r3, [r3, #44]	@ zero_extendqisi2
 248:FML/Src/EC2x.c ****         {
 780              		.loc 1 248 11 view .LVU180
 781 0018 73B9     		cbnz	r3, .L68
 255:FML/Src/EC2x.c ****             if(len > src->size)
 782              		.loc 1 255 13 is_stmt 1 view .LVU181
 255:FML/Src/EC2x.c ****             if(len > src->size)
 783              		.loc 1 255 24 is_stmt 0 view .LVU182
 784 001a C0EB0013 		rsb	r3, r0, r0, lsl #4
 785 001e 224A     		ldr	r2, .L69
 786 0020 02EB8303 		add	r3, r2, r3, lsl #2
 787 0024 0122     		movs	r2, #1
 788 0026 83F82C20 		strb	r2, [r3, #44]
 256:FML/Src/EC2x.c ****                 len = src->size;
 789              		.loc 1 256 13 is_stmt 1 view .LVU183
 256:FML/Src/EC2x.c ****                 len = src->size;
 790              		.loc 1 256 25 is_stmt 0 view .LVU184
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 25


 791 002a 188F     		ldrh	r0, [r3, #56]
 792              	.LVL61:
 256:FML/Src/EC2x.c ****                 len = src->size;
 793              		.loc 1 256 15 view .LVU185
 794 002c A842     		cmp	r0, r5
 795 002e 00D3     		bcc	.L59
 796 0030 2846     		mov	r0, r5
 797              	.L59:
 798              	.LVL62:
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 799              		.loc 1 258 13 is_stmt 1 view .LVU186
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 800              		.loc 1 258 19 is_stmt 0 view .LVU187
 801 0032 4FF0000C 		mov	ip, #0
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 802              		.loc 1 258 13 view .LVU188
 803 0036 26E0     		b	.L60
 804              	.LVL63:
 805              	.L68:
 250:FML/Src/EC2x.c ****             if(src->block == 1)
 806              		.loc 1 250 13 is_stmt 1 view .LVU189
 807 0038 6420     		movs	r0, #100
 808              	.LVL64:
 250:FML/Src/EC2x.c ****             if(src->block == 1)
 809              		.loc 1 250 13 is_stmt 0 view .LVU190
 810 003a FFF7FEFF 		bl	HAL_Delay
 811              	.LVL65:
 251:FML/Src/EC2x.c ****                 return 0;
 812              		.loc 1 251 13 is_stmt 1 view .LVU191
 251:FML/Src/EC2x.c ****                 return 0;
 813              		.loc 1 251 19 is_stmt 0 view .LVU192
 814 003e C4EB0413 		rsb	r3, r4, r4, lsl #4
 815 0042 194A     		ldr	r2, .L69
 816 0044 02EB8303 		add	r3, r2, r3, lsl #2
 817 0048 93F82C30 		ldrb	r3, [r3, #44]	@ zero_extendqisi2
 251:FML/Src/EC2x.c ****                 return 0;
 818              		.loc 1 251 15 view .LVU193
 819 004c 4BBB     		cbnz	r3, .L63
 820 004e 2846     		mov	r0, r5
 821 0050 23E0     		b	.L55
 822              	.LVL66:
 823              	.L61:
 259:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
 824              		.loc 1 259 17 is_stmt 1 discriminator 3 view .LVU194
 259:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
 825              		.loc 1 259 30 is_stmt 0 discriminator 3 view .LVU195
 826 0052 C4EB0413 		rsb	r3, r4, r4, lsl #4
 827 0056 144A     		ldr	r2, .L69
 828 0058 02EB8303 		add	r3, r2, r3, lsl #2
 829 005c 1D6B     		ldr	r5, [r3, #48]
 259:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
 830              		.loc 1 259 40 discriminator 3 view .LVU196
 831 005e 9A8E     		ldrh	r2, [r3, #52]
 259:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
 832              		.loc 1 259 36 discriminator 3 view .LVU197
 833 0060 AA5C     		ldrb	r2, [r5, r2]	@ zero_extendqisi2
 259:FML/Src/EC2x.c ****                 src->head = (src->head + 1) % src->capacity;
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 26


 834              		.loc 1 259 25 discriminator 3 view .LVU198
 835 0062 01F80C20 		strb	r2, [r1, ip]
 260:FML/Src/EC2x.c ****                 src->size--;
 836              		.loc 1 260 17 is_stmt 1 discriminator 3 view .LVU199
 260:FML/Src/EC2x.c ****                 src->size--;
 837              		.loc 1 260 33 is_stmt 0 discriminator 3 view .LVU200
 838 0066 9A8E     		ldrh	r2, [r3, #52]
 260:FML/Src/EC2x.c ****                 src->size--;
 839              		.loc 1 260 40 discriminator 3 view .LVU201
 840 0068 0132     		adds	r2, r2, #1
 260:FML/Src/EC2x.c ****                 src->size--;
 841              		.loc 1 260 50 discriminator 3 view .LVU202
 842 006a B3F83AE0 		ldrh	lr, [r3, #58]
 260:FML/Src/EC2x.c ****                 src->size--;
 843              		.loc 1 260 45 discriminator 3 view .LVU203
 844 006e 92FBFEF5 		sdiv	r5, r2, lr
 845 0072 0EFB1522 		mls	r2, lr, r5, r2
 260:FML/Src/EC2x.c ****                 src->size--;
 846              		.loc 1 260 27 discriminator 3 view .LVU204
 847 0076 9A86     		strh	r2, [r3, #52]	@ movhi
 261:FML/Src/EC2x.c ****             }
 848              		.loc 1 261 17 is_stmt 1 discriminator 3 view .LVU205
 261:FML/Src/EC2x.c ****             }
 849              		.loc 1 261 20 is_stmt 0 discriminator 3 view .LVU206
 850 0078 1A8F     		ldrh	r2, [r3, #56]
 261:FML/Src/EC2x.c ****             }
 851              		.loc 1 261 26 discriminator 3 view .LVU207
 852 007a 013A     		subs	r2, r2, #1
 853 007c 1A87     		strh	r2, [r3, #56]	@ movhi
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 854              		.loc 1 258 34 is_stmt 1 discriminator 3 view .LVU208
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 855              		.loc 1 258 35 is_stmt 0 discriminator 3 view .LVU209
 856 007e 0CF1010C 		add	ip, ip, #1
 857              	.LVL67:
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 858              		.loc 1 258 35 discriminator 3 view .LVU210
 859 0082 1FFA8CFC 		uxth	ip, ip
 860              	.LVL68:
 861              	.L60:
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 862              		.loc 1 258 25 is_stmt 1 discriminator 1 view .LVU211
 258:FML/Src/EC2x.c ****                 dest[j] = src->data[src->head];
 863              		.loc 1 258 13 is_stmt 0 discriminator 1 view .LVU212
 864 0086 6045     		cmp	r0, ip
 865 0088 E3D8     		bhi	.L61
 263:FML/Src/EC2x.c ****         }
 866              		.loc 1 263 13 is_stmt 1 view .LVU213
 263:FML/Src/EC2x.c ****         }
 867              		.loc 1 263 24 is_stmt 0 view .LVU214
 868 008a C4EB0414 		rsb	r4, r4, r4, lsl #4
 869              	.LVL69:
 263:FML/Src/EC2x.c ****         }
 870              		.loc 1 263 24 view .LVU215
 871 008e 064B     		ldr	r3, .L69
 872 0090 03EB8404 		add	r4, r3, r4, lsl #2
 873 0094 0023     		movs	r3, #0
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 27


 874 0096 84F82C30 		strb	r3, [r4, #44]
 265:FML/Src/EC2x.c ****     }
 875              		.loc 1 265 9 is_stmt 1 view .LVU216
 876              	.LVL70:
 877              	.L55:
 265:FML/Src/EC2x.c ****     }
 878              		.loc 1 265 9 is_stmt 0 view .LVU217
 879              	.LBE8:
 267:FML/Src/EC2x.c **** int ec2x_ioctl(int fd);
 880              		.loc 1 267 1 view .LVU218
 881 009a 38BD     		pop	{r3, r4, r5, pc}
 882              	.LVL71:
 883              	.L62:
 884              	.LCFI15:
 885              		.cfi_def_cfa_offset 0
 886              		.cfi_restore 3
 887              		.cfi_restore 4
 888              		.cfi_restore 5
 889              		.cfi_restore 14
 242:FML/Src/EC2x.c ****     else{
 890              		.loc 1 242 16 view .LVU219
 891 009c 4FF0FF30 		mov	r0, #-1
 892              	.LVL72:
 267:FML/Src/EC2x.c **** int ec2x_ioctl(int fd);
 893              		.loc 1 267 1 view .LVU220
 894 00a0 7047     		bx	lr
 895              	.LVL73:
 896              	.L63:
 897              	.LCFI16:
 898              		.cfi_def_cfa_offset 16
 899              		.cfi_offset 3, -16
 900              		.cfi_offset 4, -12
 901              		.cfi_offset 5, -8
 902              		.cfi_offset 14, -4
 903              	.LBB9:
 252:FML/Src/EC2x.c ****         }
 904              		.loc 1 252 24 view .LVU221
 905 00a2 2046     		mov	r0, r4
 906 00a4 F9E7     		b	.L55
 907              	.L70:
 908 00a6 00BF     		.align	2
 909              	.L69:
 910 00a8 00000000 		.word	.LANCHOR4
 911              	.LBE9:
 912              		.cfi_endproc
 913              	.LFE295:
 915              		.section	.rodata.ec2x_replymatch.str1.4,"aMS",%progbits,1
 916              		.align	2
 917              	.LC1:
 918 0000 72656376 		.ascii	"recv success\000"
 918      20737563 
 918      63657373 
 918      00
 919 000d 000000   		.align	2
 920              	.LC2:
 921 0010 6E6F2076 		.ascii	"no valid data\015\012\000"
 921      616C6964 
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 28


 921      20646174 
 921      610D0A00 
 922              		.section	.text.ec2x_replymatch,"ax",%progbits
 923              		.align	1
 924              		.global	ec2x_replymatch
 925              		.syntax unified
 926              		.thumb
 927              		.thumb_func
 929              	ec2x_replymatch:
 930              	.LVL74:
 931              	.LFB297:
 314:FML/Src/EC2x.c ****     uint8_t rx_buff[300]  = {0x00};
 932              		.loc 1 314 34 is_stmt 1 view -0
 933              		.cfi_startproc
 934              		@ args = 0, pretend = 0, frame = 304
 935              		@ frame_needed = 0, uses_anonymous_args = 0
 314:FML/Src/EC2x.c ****     uint8_t rx_buff[300]  = {0x00};
 936              		.loc 1 314 34 is_stmt 0 view .LVU223
 937 0000 30B5     		push	{r4, r5, lr}
 938              	.LCFI17:
 939              		.cfi_def_cfa_offset 12
 940              		.cfi_offset 4, -12
 941              		.cfi_offset 5, -8
 942              		.cfi_offset 14, -4
 943 0002 CDB0     		sub	sp, sp, #308
 944              	.LCFI18:
 945              		.cfi_def_cfa_offset 320
 946 0004 0546     		mov	r5, r0
 315:FML/Src/EC2x.c ****     int bytes_num = 0;
 947              		.loc 1 315 5 is_stmt 1 view .LVU224
 315:FML/Src/EC2x.c ****     int bytes_num = 0;
 948              		.loc 1 315 13 is_stmt 0 view .LVU225
 949 0006 0024     		movs	r4, #0
 950 0008 0194     		str	r4, [sp, #4]
 951 000a 4FF49472 		mov	r2, #296
 952 000e 2146     		mov	r1, r4
 953 0010 02A8     		add	r0, sp, #8
 954              	.LVL75:
 315:FML/Src/EC2x.c ****     int bytes_num = 0;
 955              		.loc 1 315 13 view .LVU226
 956 0012 FFF7FEFF 		bl	memset
 957              	.LVL76:
 316:FML/Src/EC2x.c ****     bytes_num =  ec2x_read(0,rx_buff,200);
 958              		.loc 1 316 5 is_stmt 1 view .LVU227
 317:FML/Src/EC2x.c ****     if(bytes_num > 0)
 959              		.loc 1 317 5 view .LVU228
 317:FML/Src/EC2x.c ****     if(bytes_num > 0)
 960              		.loc 1 317 18 is_stmt 0 view .LVU229
 961 0016 C822     		movs	r2, #200
 962 0018 01A9     		add	r1, sp, #4
 963 001a 2046     		mov	r0, r4
 964 001c FFF7FEFF 		bl	ec2x_read
 965              	.LVL77:
 318:FML/Src/EC2x.c ****     {
 966              		.loc 1 318 5 is_stmt 1 view .LVU230
 318:FML/Src/EC2x.c ****     {
 967              		.loc 1 318 7 is_stmt 0 view .LVU231
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 29


 968 0020 A042     		cmp	r0, r4
 969 0022 04DD     		ble	.L72
 320:FML/Src/EC2x.c ****              shellPrint(&shell,"recv success");
 970              		.loc 1 320 9 is_stmt 1 view .LVU232
 971              	.LBB10:
 320:FML/Src/EC2x.c ****              shellPrint(&shell,"recv success");
 972              		.loc 1 320 12 is_stmt 0 view .LVU233
 973 0024 2946     		mov	r1, r5
 974 0026 01A8     		add	r0, sp, #4
 975              	.LVL78:
 320:FML/Src/EC2x.c ****              shellPrint(&shell,"recv success");
 976              		.loc 1 320 12 view .LVU234
 977 0028 FFF7FEFF 		bl	strstr
 978              	.LVL79:
 320:FML/Src/EC2x.c ****              shellPrint(&shell,"recv success");
 979              		.loc 1 320 11 view .LVU235
 980 002c 40B9     		cbnz	r0, .L76
 981              	.L72:
 982              	.LBE10:
 327:FML/Src/EC2x.c ****         shellPrint(&shell,"no valid data\r\n");
 983              		.loc 1 327 5 is_stmt 1 view .LVU236
 327:FML/Src/EC2x.c ****         shellPrint(&shell,"no valid data\r\n");
 984              		.loc 1 327 20 is_stmt 0 view .LVU237
 985 002e 0E4B     		ldr	r3, .L78
 986 0030 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 327:FML/Src/EC2x.c ****         shellPrint(&shell,"no valid data\r\n");
 987              		.loc 1 327 7 view .LVU238
 988 0032 7BB1     		cbz	r3, .L77
 332:FML/Src/EC2x.c ****     return 0;
 989              		.loc 1 332 9 is_stmt 1 view .LVU239
 332:FML/Src/EC2x.c ****     return 0;
 990              		.loc 1 332 20 is_stmt 0 view .LVU240
 991 0034 013B     		subs	r3, r3, #1
 992 0036 0C4A     		ldr	r2, .L78
 993 0038 1370     		strb	r3, [r2]
 333:FML/Src/EC2x.c **** }
 994              		.loc 1 333 12 view .LVU241
 995 003a 0020     		movs	r0, #0
 996              	.L71:
 334:FML/Src/EC2x.c **** 
 997              		.loc 1 334 1 view .LVU242
 998 003c 4DB0     		add	sp, sp, #308
 999              	.LCFI19:
 1000              		.cfi_remember_state
 1001              		.cfi_def_cfa_offset 12
 1002              		@ sp needed
 1003 003e 30BD     		pop	{r4, r5, pc}
 1004              	.LVL80:
 1005              	.L76:
 1006              	.LCFI20:
 1007              		.cfi_restore_state
 1008              	.LBB11:
 321:FML/Src/EC2x.c ****              queue_insert(&ec2x_event_queue,(uint8_t)ReplyScs_Event);
 1009              		.loc 1 321 14 is_stmt 1 view .LVU243
 1010 0040 0A49     		ldr	r1, .L78+4
 1011 0042 0B48     		ldr	r0, .L78+8
 1012 0044 FFF7FEFF 		bl	shellPrint
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 30


 1013              	.LVL81:
 322:FML/Src/EC2x.c ****             return 1;
 1014              		.loc 1 322 14 view .LVU244
 1015 0048 0221     		movs	r1, #2
 1016 004a 0A48     		ldr	r0, .L78+12
 1017 004c FFF7FEFF 		bl	queue_insert
 1018              	.LVL82:
 323:FML/Src/EC2x.c ****         }
 1019              		.loc 1 323 13 view .LVU245
 323:FML/Src/EC2x.c ****         }
 1020              		.loc 1 323 20 is_stmt 0 view .LVU246
 1021 0050 0120     		movs	r0, #1
 1022 0052 F3E7     		b	.L71
 1023              	.L77:
 1024              	.LBE11:
 328:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)Timeout_Event);
 1025              		.loc 1 328 9 is_stmt 1 view .LVU247
 1026 0054 0849     		ldr	r1, .L78+16
 1027 0056 0648     		ldr	r0, .L78+8
 1028 0058 FFF7FEFF 		bl	shellPrint
 1029              	.LVL83:
 329:FML/Src/EC2x.c ****     }
 1030              		.loc 1 329 9 view .LVU248
 1031 005c 0121     		movs	r1, #1
 1032 005e 0548     		ldr	r0, .L78+12
 1033 0060 FFF7FEFF 		bl	queue_insert
 1034              	.LVL84:
 333:FML/Src/EC2x.c **** }
 1035              		.loc 1 333 12 is_stmt 0 view .LVU249
 1036 0064 0020     		movs	r0, #0
 1037 0066 E9E7     		b	.L71
 1038              	.L79:
 1039              		.align	2
 1040              	.L78:
 1041 0068 00000000 		.word	.LANCHOR0
 1042 006c 00000000 		.word	.LC1
 1043 0070 00000000 		.word	shell
 1044 0074 00000000 		.word	.LANCHOR1
 1045 0078 10000000 		.word	.LC2
 1046              		.cfi_endproc
 1047              	.LFE297:
 1049              		.section	.rodata.ec2x_handler.str1.4,"aMS",%progbits,1
 1050              		.align	2
 1051              	.LC3:
 1052 0000 257300   		.ascii	"%s\000"
 1053              		.section	.text.ec2x_handler,"ax",%progbits
 1054              		.align	1
 1055              		.global	ec2x_handler
 1056              		.syntax unified
 1057              		.thumb
 1058              		.thumb_func
 1060              	ec2x_handler:
 1061              	.LVL85:
 1062              	.LFB296:
 278:FML/Src/EC2x.c ****     uint8_t i = 0,j = 0;
 1063              		.loc 1 278 1 is_stmt 1 view -0
 1064              		.cfi_startproc
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 31


 1065              		@ args = 0, pretend = 0, frame = 0
 1066              		@ frame_needed = 0, uses_anonymous_args = 0
 278:FML/Src/EC2x.c ****     uint8_t i = 0,j = 0;
 1067              		.loc 1 278 1 is_stmt 0 view .LVU251
 1068 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1069              	.LCFI21:
 1070              		.cfi_def_cfa_offset 24
 1071              		.cfi_offset 3, -24
 1072              		.cfi_offset 4, -20
 1073              		.cfi_offset 5, -16
 1074              		.cfi_offset 6, -12
 1075              		.cfi_offset 7, -8
 1076              		.cfi_offset 14, -4
 1077 0002 0546     		mov	r5, r0
 1078 0004 0C46     		mov	r4, r1
 1079 0006 1646     		mov	r6, r2
 279:FML/Src/EC2x.c ****     shellPrint(&shell,"%s",data);
 1080              		.loc 1 279 5 is_stmt 1 view .LVU252
 1081              	.LVL86:
 280:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 1082              		.loc 1 280 5 view .LVU253
 1083 0008 0A46     		mov	r2, r1
 1084              	.LVL87:
 280:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 1085              		.loc 1 280 5 is_stmt 0 view .LVU254
 1086 000a 3549     		ldr	r1, .L90
 1087              	.LVL88:
 280:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 1088              		.loc 1 280 5 view .LVU255
 1089 000c 3548     		ldr	r0, .L90+4
 1090              	.LVL89:
 280:FML/Src/EC2x.c ****     for(i = 0;i < sizeof(ec2x_dev)/ sizeof(EC2x_HandleTypeDef);i++)
 1091              		.loc 1 280 5 view .LVU256
 1092 000e FFF7FEFF 		bl	shellPrint
 1093              	.LVL90:
 281:FML/Src/EC2x.c ****     {
 1094              		.loc 1 281 5 is_stmt 1 view .LVU257
 281:FML/Src/EC2x.c ****     {
 1095              		.loc 1 281 11 is_stmt 0 view .LVU258
 1096 0012 0023     		movs	r3, #0
 1097              	.LVL91:
 1098              	.L81:
 281:FML/Src/EC2x.c ****     {
 1099              		.loc 1 281 15 is_stmt 1 discriminator 1 view .LVU259
 281:FML/Src/EC2x.c ****     {
 1100              		.loc 1 281 5 is_stmt 0 discriminator 1 view .LVU260
 1101 0014 03B1     		cbz	r3, .L86
 301:FML/Src/EC2x.c **** 
 1102              		.loc 1 301 1 view .LVU261
 1103 0016 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1104              	.LVL92:
 1105              	.L86:
 283:FML/Src/EC2x.c ****         {
 1106              		.loc 1 283 9 is_stmt 1 view .LVU262
 283:FML/Src/EC2x.c ****         {
 1107              		.loc 1 283 32 is_stmt 0 view .LVU263
 1108 0018 9E46     		mov	lr, r3
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 32


 1109 001a C3EB0312 		rsb	r2, r3, r3, lsl #4
 1110 001e 3249     		ldr	r1, .L90+8
 1111 0020 01EB8202 		add	r2, r1, r2, lsl #2
 1112 0024 1269     		ldr	r2, [r2, #16]
 283:FML/Src/EC2x.c ****         {
 1113              		.loc 1 283 11 view .LVU264
 1114 0026 AA42     		cmp	r2, r5
 1115 0028 02D0     		beq	.L88
 1116              	.L82:
 281:FML/Src/EC2x.c ****     {
 1117              		.loc 1 281 64 is_stmt 1 discriminator 2 view .LVU265
 281:FML/Src/EC2x.c ****     {
 1118              		.loc 1 281 65 is_stmt 0 discriminator 2 view .LVU266
 1119 002a 0133     		adds	r3, r3, #1
 1120              	.LVL93:
 281:FML/Src/EC2x.c ****     {
 1121              		.loc 1 281 65 discriminator 2 view .LVU267
 1122 002c DBB2     		uxtb	r3, r3
 1123              	.LVL94:
 281:FML/Src/EC2x.c ****     {
 1124              		.loc 1 281 65 discriminator 2 view .LVU268
 1125 002e F1E7     		b	.L81
 1126              	.L88:
 1127              	.LBB12:
 285:FML/Src/EC2x.c ****             if(dest->block  == 0){
 1128              		.loc 1 285 13 is_stmt 1 view .LVU269
 1129              	.LVL95:
 286:FML/Src/EC2x.c ****                 dest->block = 1;
 1130              		.loc 1 286 13 view .LVU270
 286:FML/Src/EC2x.c ****                 dest->block = 1;
 1131              		.loc 1 286 20 is_stmt 0 view .LVU271
 1132 0030 C3EB0312 		rsb	r2, r3, r3, lsl #4
 1133 0034 01EB8202 		add	r2, r1, r2, lsl #2
 1134 0038 92F82C20 		ldrb	r2, [r2, #44]	@ zero_extendqisi2
 286:FML/Src/EC2x.c ****                 dest->block = 1;
 1135              		.loc 1 286 15 view .LVU272
 1136 003c 002A     		cmp	r2, #0
 1137 003e F4D1     		bne	.L82
 287:FML/Src/EC2x.c ****                 for(j = 0 ; j < len; j++){
 1138              		.loc 1 287 17 is_stmt 1 view .LVU273
 287:FML/Src/EC2x.c ****                 for(j = 0 ; j < len; j++){
 1139              		.loc 1 287 29 is_stmt 0 view .LVU274
 1140 0040 C3EB0312 		rsb	r2, r3, r3, lsl #4
 1141 0044 01EB8202 		add	r2, r1, r2, lsl #2
 1142 0048 0121     		movs	r1, #1
 1143 004a 82F82C10 		strb	r1, [r2, #44]
 288:FML/Src/EC2x.c ****                    
 1144              		.loc 1 288 17 is_stmt 1 view .LVU275
 1145              	.LVL96:
 288:FML/Src/EC2x.c ****                    
 1146              		.loc 1 288 23 is_stmt 0 view .LVU276
 1147 004e 1846     		mov	r0, r3
 288:FML/Src/EC2x.c ****                    
 1148              		.loc 1 288 17 view .LVU277
 1149 0050 22E0     		b	.L83
 1150              	.LVL97:
 1151              	.L84:
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 33


 290:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 1152              		.loc 1 290 21 is_stmt 1 discriminator 3 view .LVU278
 290:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 1153              		.loc 1 290 25 is_stmt 0 discriminator 3 view .LVU279
 1154 0052 CEEB0E1C 		rsb	ip, lr, lr, lsl #4
 1155 0056 244A     		ldr	r2, .L90+8
 1156 0058 02EB8C0C 		add	ip, r2, ip, lsl #2
 1157 005c DCF83020 		ldr	r2, [ip, #48]
 290:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 1158              		.loc 1 290 36 discriminator 3 view .LVU280
 1159 0060 BCF83610 		ldrh	r1, [ip, #54]
 290:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 1160              		.loc 1 290 50 discriminator 3 view .LVU281
 1161 0064 275C     		ldrb	r7, [r4, r0]	@ zero_extendqisi2
 290:FML/Src/EC2x.c ****                     dest->tail = (dest->tail +1) % dest->capacity;
 1162              		.loc 1 290 44 discriminator 3 view .LVU282
 1163 0066 5754     		strb	r7, [r2, r1]
 291:FML/Src/EC2x.c ****                     dest->size++;
 1164              		.loc 1 291 21 is_stmt 1 discriminator 3 view .LVU283
 291:FML/Src/EC2x.c ****                     dest->size++;
 1165              		.loc 1 291 39 is_stmt 0 discriminator 3 view .LVU284
 1166 0068 BCF83620 		ldrh	r2, [ip, #54]
 291:FML/Src/EC2x.c ****                     dest->size++;
 1167              		.loc 1 291 46 discriminator 3 view .LVU285
 1168 006c 0132     		adds	r2, r2, #1
 291:FML/Src/EC2x.c ****                     dest->size++;
 1169              		.loc 1 291 56 discriminator 3 view .LVU286
 1170 006e BCF83A70 		ldrh	r7, [ip, #58]
 291:FML/Src/EC2x.c ****                     dest->size++;
 1171              		.loc 1 291 50 discriminator 3 view .LVU287
 1172 0072 92FBF7F1 		sdiv	r1, r2, r7
 1173 0076 07FB1122 		mls	r2, r7, r1, r2
 291:FML/Src/EC2x.c ****                     dest->size++;
 1174              		.loc 1 291 32 discriminator 3 view .LVU288
 1175 007a ACF83620 		strh	r2, [ip, #54]	@ movhi
 292:FML/Src/EC2x.c ****                     dest->size = dest->size > dest->capacity ? dest->capacity : dest->size;
 1176              		.loc 1 292 21 is_stmt 1 discriminator 3 view .LVU289
 292:FML/Src/EC2x.c ****                     dest->size = dest->size > dest->capacity ? dest->capacity : dest->size;
 1177              		.loc 1 292 25 is_stmt 0 discriminator 3 view .LVU290
 1178 007e BCF83810 		ldrh	r1, [ip, #56]
 292:FML/Src/EC2x.c ****                     dest->size = dest->size > dest->capacity ? dest->capacity : dest->size;
 1179              		.loc 1 292 31 discriminator 3 view .LVU291
 1180 0082 0131     		adds	r1, r1, #1
 1181 0084 89B2     		uxth	r1, r1
 1182 0086 ACF83810 		strh	r1, [ip, #56]	@ movhi
 293:FML/Src/EC2x.c ****                 }
 1183              		.loc 1 293 21 is_stmt 1 discriminator 3 view .LVU292
 293:FML/Src/EC2x.c ****                 }
 1184              		.loc 1 293 79 is_stmt 0 discriminator 3 view .LVU293
 1185 008a B942     		cmp	r1, r7
 1186 008c 28BF     		it	cs
 1187 008e 3946     		movcs	r1, r7
 293:FML/Src/EC2x.c ****                 }
 1188              		.loc 1 293 32 discriminator 3 view .LVU294
 1189 0090 ACF83810 		strh	r1, [ip, #56]	@ movhi
 288:FML/Src/EC2x.c ****                    
 1190              		.loc 1 288 38 is_stmt 1 discriminator 3 view .LVU295
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 34


 288:FML/Src/EC2x.c ****                    
 1191              		.loc 1 288 39 is_stmt 0 discriminator 3 view .LVU296
 1192 0094 0130     		adds	r0, r0, #1
 1193              	.LVL98:
 288:FML/Src/EC2x.c ****                    
 1194              		.loc 1 288 39 discriminator 3 view .LVU297
 1195 0096 C0B2     		uxtb	r0, r0
 1196              	.LVL99:
 1197              	.L83:
 288:FML/Src/EC2x.c ****                    
 1198              		.loc 1 288 29 is_stmt 1 discriminator 1 view .LVU298
 288:FML/Src/EC2x.c ****                    
 1199              		.loc 1 288 31 is_stmt 0 discriminator 1 view .LVU299
 1200 0098 82B2     		uxth	r2, r0
 288:FML/Src/EC2x.c ****                    
 1201              		.loc 1 288 17 discriminator 1 view .LVU300
 1202 009a B242     		cmp	r2, r6
 1203 009c D9D3     		bcc	.L84
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1204              		.loc 1 295 17 is_stmt 1 view .LVU301
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1205              		.loc 1 295 25 is_stmt 0 view .LVU302
 1206 009e CEEB0E12 		rsb	r2, lr, lr, lsl #4
 1207 00a2 1149     		ldr	r1, .L90+8
 1208 00a4 01EB8202 		add	r2, r1, r2, lsl #2
 1209 00a8 D08E     		ldrh	r0, [r2, #54]
 1210              	.LVL100:
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1211              		.loc 1 295 38 view .LVU303
 1212 00aa 928E     		ldrh	r2, [r2, #52]
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1213              		.loc 1 295 19 view .LVU304
 1214 00ac 9042     		cmp	r0, r2
 1215 00ae 07D9     		bls	.L85
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1216              		.loc 1 295 52 discriminator 1 view .LVU305
 1217 00b0 CEEB0E12 		rsb	r2, lr, lr, lsl #4
 1218 00b4 01EB8202 		add	r2, r1, r2, lsl #2
 1219 00b8 118F     		ldrh	r1, [r2, #56]
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1220              		.loc 1 295 66 discriminator 1 view .LVU306
 1221 00ba 528F     		ldrh	r2, [r2, #58]
 295:FML/Src/EC2x.c ****                     dest->head = dest->tail;
 1222              		.loc 1 295 45 discriminator 1 view .LVU307
 1223 00bc 9142     		cmp	r1, r2
 1224 00be 08D0     		beq	.L89
 1225              	.L85:
 297:FML/Src/EC2x.c ****             }
 1226              		.loc 1 297 17 is_stmt 1 view .LVU308
 297:FML/Src/EC2x.c ****             }
 1227              		.loc 1 297 29 is_stmt 0 view .LVU309
 1228 00c0 CEEB0E1E 		rsb	lr, lr, lr, lsl #4
 1229 00c4 084A     		ldr	r2, .L90+8
 1230 00c6 02EB8E0E 		add	lr, r2, lr, lsl #2
 1231 00ca 0022     		movs	r2, #0
 1232 00cc 8EF82C20 		strb	r2, [lr, #44]
 1233 00d0 ABE7     		b	.L82
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 35


 1234              	.L89:
 296:FML/Src/EC2x.c ****                 dest->block = 0;
 1235              		.loc 1 296 21 is_stmt 1 view .LVU310
 296:FML/Src/EC2x.c ****                 dest->block = 0;
 1236              		.loc 1 296 32 is_stmt 0 view .LVU311
 1237 00d2 CEEB0E12 		rsb	r2, lr, lr, lsl #4
 1238 00d6 0449     		ldr	r1, .L90+8
 1239 00d8 01EB8202 		add	r2, r1, r2, lsl #2
 1240 00dc 9086     		strh	r0, [r2, #52]	@ movhi
 1241 00de EFE7     		b	.L85
 1242              	.L91:
 1243              		.align	2
 1244              	.L90:
 1245 00e0 00000000 		.word	.LC3
 1246 00e4 00000000 		.word	shell
 1247 00e8 00000000 		.word	.LANCHOR4
 1248              	.LBE12:
 1249              		.cfi_endproc
 1250              	.LFE296:
 1252              		.section	.rodata.ec2x_fms_proccess.str1.4,"aMS",%progbits,1
 1253              		.align	2
 1254              	.LC4:
 1255 0000 4375722D 		.ascii	"Cur->State:%d ,Evt:%d,\000"
 1255      3E537461 
 1255      74653A25 
 1255      64202C45 
 1255      76743A25 
 1256 0017 00       		.align	2
 1257              	.LC5:
 1258 0018 4E657874 		.ascii	"Next->State:%d\015\012\000"
 1258      2D3E5374 
 1258      6174653A 
 1258      25640D0A 
 1258      00
 1259              		.section	.text.ec2x_fms_proccess,"ax",%progbits
 1260              		.align	1
 1261              		.global	ec2x_fms_proccess
 1262              		.syntax unified
 1263              		.thumb
 1264              		.thumb_func
 1266              	ec2x_fms_proccess:
 1267              	.LFB303:
 420:FML/Src/EC2x.c **** 
 421:FML/Src/EC2x.c **** /**
 422:FML/Src/EC2x.c ****  * @brief 状态机运行函数
 423:FML/Src/EC2x.c ****  * 
 424:FML/Src/EC2x.c ****  */
 425:FML/Src/EC2x.c **** void ec2x_fms_proccess(void){
 1268              		.loc 1 425 29 is_stmt 1 view -0
 1269              		.cfi_startproc
 1270              		@ args = 0, pretend = 0, frame = 8
 1271              		@ frame_needed = 0, uses_anonymous_args = 0
 1272 0000 30B5     		push	{r4, r5, lr}
 1273              	.LCFI22:
 1274              		.cfi_def_cfa_offset 12
 1275              		.cfi_offset 4, -12
 1276              		.cfi_offset 5, -8
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 36


 1277              		.cfi_offset 14, -4
 1278 0002 83B0     		sub	sp, sp, #12
 1279              	.LCFI23:
 1280              		.cfi_def_cfa_offset 24
 426:FML/Src/EC2x.c ****     if(queue_is_empty(&ec2x_event_queue) == 0){
 1281              		.loc 1 426 5 view .LVU313
 1282              		.loc 1 426 8 is_stmt 0 view .LVU314
 1283 0004 1148     		ldr	r0, .L96
 1284 0006 FFF7FEFF 		bl	queue_is_empty
 1285              	.LVL101:
 1286              		.loc 1 426 7 view .LVU315
 1287 000a 08B1     		cbz	r0, .L95
 1288              	.L92:
 427:FML/Src/EC2x.c ****         EC2x_Event_T evt = 0x00;
 428:FML/Src/EC2x.c ****         queue_pop(&ec2x_event_queue,&evt,1);
 429:FML/Src/EC2x.c ****         shellPrint(&shell,"Cur->State:%d ,Evt:%d,",(&ec2x_fsm)->state,evt);
 430:FML/Src/EC2x.c ****         FSM_EventHandle(&ec2x_fsm,evt);
 431:FML/Src/EC2x.c ****         shellPrint(&shell,"Next->State:%d\r\n",(&ec2x_fsm)->state);
 432:FML/Src/EC2x.c ****     }
 433:FML/Src/EC2x.c **** }
 1289              		.loc 1 433 1 view .LVU316
 1290 000c 03B0     		add	sp, sp, #12
 1291              	.LCFI24:
 1292              		.cfi_remember_state
 1293              		.cfi_def_cfa_offset 12
 1294              		@ sp needed
 1295 000e 30BD     		pop	{r4, r5, pc}
 1296              	.L95:
 1297              	.LCFI25:
 1298              		.cfi_restore_state
 1299              	.LBB13:
 427:FML/Src/EC2x.c ****         EC2x_Event_T evt = 0x00;
 1300              		.loc 1 427 9 is_stmt 1 view .LVU317
 427:FML/Src/EC2x.c ****         EC2x_Event_T evt = 0x00;
 1301              		.loc 1 427 22 is_stmt 0 view .LVU318
 1302 0010 0023     		movs	r3, #0
 1303 0012 8DF80730 		strb	r3, [sp, #7]
 428:FML/Src/EC2x.c ****         shellPrint(&shell,"Cur->State:%d ,Evt:%d,",(&ec2x_fsm)->state,evt);
 1304              		.loc 1 428 9 is_stmt 1 view .LVU319
 1305 0016 0122     		movs	r2, #1
 1306 0018 0DF10701 		add	r1, sp, #7
 1307 001c 0B48     		ldr	r0, .L96
 1308 001e FFF7FEFF 		bl	queue_pop
 1309              	.LVL102:
 429:FML/Src/EC2x.c ****         FSM_EventHandle(&ec2x_fsm,evt);
 1310              		.loc 1 429 9 view .LVU320
 429:FML/Src/EC2x.c ****         FSM_EventHandle(&ec2x_fsm,evt);
 1311              		.loc 1 429 63 is_stmt 0 view .LVU321
 1312 0022 0B4C     		ldr	r4, .L96+4
 429:FML/Src/EC2x.c ****         FSM_EventHandle(&ec2x_fsm,evt);
 1313              		.loc 1 429 9 view .LVU322
 1314 0024 0B4D     		ldr	r5, .L96+8
 1315 0026 9DF80730 		ldrb	r3, [sp, #7]	@ zero_extendqisi2
 1316 002a 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 1317 002c 0A49     		ldr	r1, .L96+12
 1318 002e 2846     		mov	r0, r5
 1319 0030 FFF7FEFF 		bl	shellPrint
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 37


 1320              	.LVL103:
 430:FML/Src/EC2x.c ****         shellPrint(&shell,"Next->State:%d\r\n",(&ec2x_fsm)->state);
 1321              		.loc 1 430 9 is_stmt 1 view .LVU323
 1322 0034 9DF80710 		ldrb	r1, [sp, #7]	@ zero_extendqisi2
 1323 0038 2046     		mov	r0, r4
 1324 003a FFF7FEFF 		bl	FSM_EventHandle
 1325              	.LVL104:
 431:FML/Src/EC2x.c ****     }
 1326              		.loc 1 431 9 view .LVU324
 1327 003e 2278     		ldrb	r2, [r4]	@ zero_extendqisi2
 1328 0040 0649     		ldr	r1, .L96+16
 1329 0042 2846     		mov	r0, r5
 1330 0044 FFF7FEFF 		bl	shellPrint
 1331              	.LVL105:
 1332              	.LBE13:
 1333              		.loc 1 433 1 is_stmt 0 view .LVU325
 1334 0048 E0E7     		b	.L92
 1335              	.L97:
 1336 004a 00BF     		.align	2
 1337              	.L96:
 1338 004c 00000000 		.word	.LANCHOR1
 1339 0050 00000000 		.word	.LANCHOR8
 1340 0054 00000000 		.word	shell
 1341 0058 00000000 		.word	.LC4
 1342 005c 18000000 		.word	.LC5
 1343              		.cfi_endproc
 1344              	.LFE303:
 1346              		.section	.text.ec2x_tcp_connect,"ax",%progbits
 1347              		.align	1
 1348              		.global	ec2x_tcp_connect
 1349              		.syntax unified
 1350              		.thumb
 1351              		.thumb_func
 1353              	ec2x_tcp_connect:
 1354              	.LVL106:
 1355              	.LFB304:
 434:FML/Src/EC2x.c **** /**
 435:FML/Src/EC2x.c ****  * @brief tcp 连接流程
 436:FML/Src/EC2x.c ****  * 
 437:FML/Src/EC2x.c ****  * @param fd 
 438:FML/Src/EC2x.c ****  * @return uint8_t 
 439:FML/Src/EC2x.c ****  */
 440:FML/Src/EC2x.c **** uint8_t ec2x_tcp_connect(int fd){
 1356              		.loc 1 440 33 is_stmt 1 view -0
 1357              		.cfi_startproc
 1358              		@ args = 0, pretend = 0, frame = 0
 1359              		@ frame_needed = 0, uses_anonymous_args = 0
 1360              		.loc 1 440 33 is_stmt 0 view .LVU327
 1361 0000 10B5     		push	{r4, lr}
 1362              	.LCFI26:
 1363              		.cfi_def_cfa_offset 8
 1364              		.cfi_offset 4, -8
 1365              		.cfi_offset 14, -4
 441:FML/Src/EC2x.c ****     uint8_t err_code = 0;
 1366              		.loc 1 441 5 is_stmt 1 view .LVU328
 1367              	.LVL107:
 442:FML/Src/EC2x.c ****     uint8_t i = 0;
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 38


 1368              		.loc 1 442 5 view .LVU329
 443:FML/Src/EC2x.c ****     for(i = 0; i < sizeof(connectmsg_queue)/sizeof(ATMsg_TypeDef); ++i)
 1369              		.loc 1 443 5 view .LVU330
 1370              		.loc 1 443 11 is_stmt 0 view .LVU331
 1371 0002 0024     		movs	r4, #0
 1372              		.loc 1 443 5 view .LVU332
 1373 0004 09E0     		b	.L99
 1374              	.LVL108:
 1375              	.L100:
 444:FML/Src/EC2x.c ****     {
 445:FML/Src/EC2x.c ****         queue_insert(&ec2x_txmsg_queue,(int *)&connectmsg_queue[i]);
 1376              		.loc 1 445 9 is_stmt 1 discriminator 3 view .LVU333
 1377              		.loc 1 445 47 is_stmt 0 discriminator 3 view .LVU334
 1378 0006 04EB4402 		add	r2, r4, r4, lsl #1
 1379 000a 9300     		lsls	r3, r2, #2
 1380              		.loc 1 445 9 discriminator 3 view .LVU335
 1381 000c 0649     		ldr	r1, .L102
 1382 000e 1944     		add	r1, r1, r3
 1383 0010 0648     		ldr	r0, .L102+4
 1384 0012 FFF7FEFF 		bl	queue_insert
 1385              	.LVL109:
 443:FML/Src/EC2x.c ****     for(i = 0; i < sizeof(connectmsg_queue)/sizeof(ATMsg_TypeDef); ++i)
 1386              		.loc 1 443 68 is_stmt 1 discriminator 3 view .LVU336
 1387 0016 0134     		adds	r4, r4, #1
 1388              	.LVL110:
 443:FML/Src/EC2x.c ****     for(i = 0; i < sizeof(connectmsg_queue)/sizeof(ATMsg_TypeDef); ++i)
 1389              		.loc 1 443 68 is_stmt 0 discriminator 3 view .LVU337
 1390 0018 E4B2     		uxtb	r4, r4
 1391              	.LVL111:
 1392              	.L99:
 443:FML/Src/EC2x.c ****     for(i = 0; i < sizeof(connectmsg_queue)/sizeof(ATMsg_TypeDef); ++i)
 1393              		.loc 1 443 16 is_stmt 1 discriminator 1 view .LVU338
 443:FML/Src/EC2x.c ****     for(i = 0; i < sizeof(connectmsg_queue)/sizeof(ATMsg_TypeDef); ++i)
 1394              		.loc 1 443 5 is_stmt 0 discriminator 1 view .LVU339
 1395 001a 062C     		cmp	r4, #6
 1396 001c F3D9     		bls	.L100
 446:FML/Src/EC2x.c ****     }
 447:FML/Src/EC2x.c ****     queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 1397              		.loc 1 447 5 is_stmt 1 view .LVU340
 1398 001e 0321     		movs	r1, #3
 1399 0020 0348     		ldr	r0, .L102+8
 1400 0022 FFF7FEFF 		bl	queue_insert
 1401              	.LVL112:
 448:FML/Src/EC2x.c **** }
 1402              		.loc 1 448 1 is_stmt 0 view .LVU341
 1403 0026 10BD     		pop	{r4, pc}
 1404              	.LVL113:
 1405              	.L103:
 1406              		.loc 1 448 1 view .LVU342
 1407              		.align	2
 1408              	.L102:
 1409 0028 00000000 		.word	.LANCHOR9
 1410 002c 00000000 		.word	.LANCHOR2
 1411 0030 00000000 		.word	.LANCHOR1
 1412              		.cfi_endproc
 1413              	.LFE304:
 1415              		.section	.rodata.EC2x_Test.str1.4,"aMS",%progbits,1
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 39


 1416              		.align	2
 1417              	.LC6:
 1418 0000 7463705F 		.ascii	"tcp_connect\000"
 1418      636F6E6E 
 1418      65637400 
 1419              		.section	.text.EC2x_Test,"ax",%progbits
 1420              		.align	1
 1421              		.global	EC2x_Test
 1422              		.syntax unified
 1423              		.thumb
 1424              		.thumb_func
 1426              	EC2x_Test:
 1427              	.LVL114:
 1428              	.LFB305:
 449:FML/Src/EC2x.c **** /*------------------------------------test------------------------------------*/
 450:FML/Src/EC2x.c **** 
 451:FML/Src/EC2x.c **** /**
 452:FML/Src/EC2x.c ****  * @brief 
 453:FML/Src/EC2x.c ****  * 
 454:FML/Src/EC2x.c ****  * @param fd 
 455:FML/Src/EC2x.c ****  * @param tx_buff 
 456:FML/Src/EC2x.c ****  * @param expect_reply 
 457:FML/Src/EC2x.c ****  * @param timeout 
 458:FML/Src/EC2x.c ****  */
 459:FML/Src/EC2x.c **** void EC2x_Test(int fd,char *tx_buff,char *expect_reply,uint16_t timeout)
 460:FML/Src/EC2x.c **** {
 1429              		.loc 1 460 1 is_stmt 1 view -0
 1430              		.cfi_startproc
 1431              		@ args = 0, pretend = 0, frame = 0
 1432              		@ frame_needed = 0, uses_anonymous_args = 0
 1433              		.loc 1 460 1 is_stmt 0 view .LVU344
 1434 0000 2DE9F84F 		push	{r3, r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1435              	.LCFI27:
 1436              		.cfi_def_cfa_offset 40
 1437              		.cfi_offset 3, -40
 1438              		.cfi_offset 4, -36
 1439              		.cfi_offset 5, -32
 1440              		.cfi_offset 6, -28
 1441              		.cfi_offset 7, -24
 1442              		.cfi_offset 8, -20
 1443              		.cfi_offset 9, -16
 1444              		.cfi_offset 10, -12
 1445              		.cfi_offset 11, -8
 1446              		.cfi_offset 14, -4
 1447 0004 0746     		mov	r7, r0
 1448 0006 8B46     		mov	fp, r1
 1449 0008 1646     		mov	r6, r2
 1450 000a 9846     		mov	r8, r3
 461:FML/Src/EC2x.c ****     uint8_t *tx_data,reply_data,tx_len = 0,reply_len = 0;
 1451              		.loc 1 461 5 is_stmt 1 view .LVU345
 1452              	.LVL115:
 462:FML/Src/EC2x.c ****     tx_len = strlen(tx_buff);
 1453              		.loc 1 462 5 view .LVU346
 1454              		.loc 1 462 14 is_stmt 0 view .LVU347
 1455 000c 0846     		mov	r0, r1
 1456              	.LVL116:
 1457              		.loc 1 462 14 view .LVU348
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 40


 1458 000e FFF7FEFF 		bl	strlen
 1459              	.LVL117:
 1460              		.loc 1 462 14 view .LVU349
 1461 0012 0446     		mov	r4, r0
 1462              	.LVL118:
 463:FML/Src/EC2x.c ****     reply_len = strlen(expect_reply);
 1463              		.loc 1 463 5 is_stmt 1 view .LVU350
 1464              		.loc 1 463 17 is_stmt 0 view .LVU351
 1465 0014 3046     		mov	r0, r6
 1466 0016 FFF7FEFF 		bl	strlen
 1467              	.LVL119:
 1468 001a 0546     		mov	r5, r0
 1469              	.LVL120:
 464:FML/Src/EC2x.c ****     if(strcmp(tx_buff,"tcp_connect")==0){
 1470              		.loc 1 464 5 is_stmt 1 view .LVU352
 1471              	.LBB14:
 1472              		.loc 1 464 8 is_stmt 0 view .LVU353
 1473 001c 1E49     		ldr	r1, .L108
 1474 001e 5846     		mov	r0, fp
 1475 0020 FFF7FEFF 		bl	strcmp
 1476              	.LVL121:
 1477              		.loc 1 464 7 view .LVU354
 1478 0024 20B9     		cbnz	r0, .L105
 465:FML/Src/EC2x.c ****         ec2x_tcp_connect(fd);
 1479              		.loc 1 465 9 is_stmt 1 view .LVU355
 1480 0026 3846     		mov	r0, r7
 1481 0028 FFF7FEFF 		bl	ec2x_tcp_connect
 1482              	.LVL122:
 1483              	.L104:
 1484              		.loc 1 465 9 is_stmt 0 view .LVU356
 1485              	.LBE14:
 466:FML/Src/EC2x.c ****     }
 467:FML/Src/EC2x.c ****     else{
 468:FML/Src/EC2x.c ****         ATMsg_TypeDef *msg_send = (ATMsg_TypeDef *)malloc(sizeof(ATMsg_TypeDef));
 469:FML/Src/EC2x.c ****         tx_data = (char *)malloc((tx_len+2)*sizeof(uint8_t));
 470:FML/Src/EC2x.c ****         reply_data = (char *)malloc((reply_len)*sizeof(uint8_t));
 471:FML/Src/EC2x.c **** 
 472:FML/Src/EC2x.c ****         memcpy(tx_data,tx_buff,tx_len);
 473:FML/Src/EC2x.c ****         tx_data[tx_len] = 0x0D;
 474:FML/Src/EC2x.c ****         tx_data[tx_len+1] = 0x0A;
 475:FML/Src/EC2x.c **** 
 476:FML/Src/EC2x.c ****         memcpy(reply_data,expect_reply,reply_len);
 477:FML/Src/EC2x.c ****         
 478:FML/Src/EC2x.c ****         msg_send->expect_reply = reply_data;
 479:FML/Src/EC2x.c ****         msg_send->retry_times = timeout / 100;
 480:FML/Src/EC2x.c ****         msg_send->timeout = timeout;
 481:FML/Src/EC2x.c ****         msg_send->txmsg = tx_data;
 482:FML/Src/EC2x.c **** 
 483:FML/Src/EC2x.c ****         queue_insert(&ec2x_txmsg_queue,msg_send);
 484:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 485:FML/Src/EC2x.c ****         
 486:FML/Src/EC2x.c ****     }
 487:FML/Src/EC2x.c **** }
 1486              		.loc 1 487 1 view .LVU357
 1487 002c BDE8F88F 		pop	{r3, r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1488              	.LVL123:
 1489              	.L105:
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 41


 1490              	.LBB16:
 1491              	.LBB15:
 468:FML/Src/EC2x.c ****         tx_data = (char *)malloc((tx_len+2)*sizeof(uint8_t));
 1492              		.loc 1 468 9 is_stmt 1 view .LVU358
 468:FML/Src/EC2x.c ****         tx_data = (char *)malloc((tx_len+2)*sizeof(uint8_t));
 1493              		.loc 1 468 52 is_stmt 0 view .LVU359
 1494 0030 0C20     		movs	r0, #12
 1495 0032 FFF7FEFF 		bl	malloc
 1496              	.LVL124:
 1497 0036 0746     		mov	r7, r0
 1498              	.LVL125:
 469:FML/Src/EC2x.c ****         reply_data = (char *)malloc((reply_len)*sizeof(uint8_t));
 1499              		.loc 1 469 9 is_stmt 1 view .LVU360
 1500 0038 E4B2     		uxtb	r4, r4
 469:FML/Src/EC2x.c ****         reply_data = (char *)malloc((reply_len)*sizeof(uint8_t));
 1501              		.loc 1 469 27 is_stmt 0 view .LVU361
 1502 003a A01C     		adds	r0, r4, #2
 1503              	.LVL126:
 469:FML/Src/EC2x.c ****         reply_data = (char *)malloc((reply_len)*sizeof(uint8_t));
 1504              		.loc 1 469 27 view .LVU362
 1505 003c FFF7FEFF 		bl	malloc
 1506              	.LVL127:
 1507 0040 8146     		mov	r9, r0
 1508              	.LVL128:
 470:FML/Src/EC2x.c **** 
 1509              		.loc 1 470 9 is_stmt 1 view .LVU363
 1510 0042 EDB2     		uxtb	r5, r5
 470:FML/Src/EC2x.c **** 
 1511              		.loc 1 470 30 is_stmt 0 view .LVU364
 1512 0044 2846     		mov	r0, r5
 1513              	.LVL129:
 470:FML/Src/EC2x.c **** 
 1514              		.loc 1 470 30 view .LVU365
 1515 0046 FFF7FEFF 		bl	malloc
 1516              	.LVL130:
 1517 004a 8246     		mov	r10, r0
 1518              	.LVL131:
 472:FML/Src/EC2x.c ****         tx_data[tx_len] = 0x0D;
 1519              		.loc 1 472 9 is_stmt 1 view .LVU366
 1520 004c 2246     		mov	r2, r4
 1521 004e 5946     		mov	r1, fp
 1522 0050 4846     		mov	r0, r9
 1523 0052 FFF7FEFF 		bl	memcpy
 1524              	.LVL132:
 473:FML/Src/EC2x.c ****         tx_data[tx_len+1] = 0x0A;
 1525              		.loc 1 473 9 view .LVU367
 473:FML/Src/EC2x.c ****         tx_data[tx_len+1] = 0x0A;
 1526              		.loc 1 473 25 is_stmt 0 view .LVU368
 1527 0056 0D23     		movs	r3, #13
 1528 0058 09F80430 		strb	r3, [r9, r4]
 474:FML/Src/EC2x.c **** 
 1529              		.loc 1 474 9 is_stmt 1 view .LVU369
 474:FML/Src/EC2x.c **** 
 1530              		.loc 1 474 16 is_stmt 0 view .LVU370
 1531 005c 0134     		adds	r4, r4, #1
 1532              	.LVL133:
 474:FML/Src/EC2x.c **** 
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 42


 1533              		.loc 1 474 27 view .LVU371
 1534 005e 0A23     		movs	r3, #10
 1535 0060 09F80430 		strb	r3, [r9, r4]
 476:FML/Src/EC2x.c ****         
 1536              		.loc 1 476 9 is_stmt 1 view .LVU372
 1537 0064 5FFA8AF4 		uxtb	r4, r10
 1538              	.LVL134:
 476:FML/Src/EC2x.c ****         
 1539              		.loc 1 476 9 is_stmt 0 view .LVU373
 1540 0068 2A46     		mov	r2, r5
 1541 006a 3146     		mov	r1, r6
 1542 006c 2046     		mov	r0, r4
 1543 006e FFF7FEFF 		bl	memcpy
 1544              	.LVL135:
 478:FML/Src/EC2x.c ****         msg_send->retry_times = timeout / 100;
 1545              		.loc 1 478 9 is_stmt 1 view .LVU374
 478:FML/Src/EC2x.c ****         msg_send->retry_times = timeout / 100;
 1546              		.loc 1 478 32 is_stmt 0 view .LVU375
 1547 0072 7C60     		str	r4, [r7, #4]
 479:FML/Src/EC2x.c ****         msg_send->timeout = timeout;
 1548              		.loc 1 479 9 is_stmt 1 view .LVU376
 479:FML/Src/EC2x.c ****         msg_send->timeout = timeout;
 1549              		.loc 1 479 31 is_stmt 0 view .LVU377
 1550 0074 094B     		ldr	r3, .L108+4
 1551 0076 A3FB0823 		umull	r2, r3, r3, r8
 1552 007a 5B09     		lsrs	r3, r3, #5
 1553 007c BB72     		strb	r3, [r7, #10]
 480:FML/Src/EC2x.c ****         msg_send->txmsg = tx_data;
 1554              		.loc 1 480 9 is_stmt 1 view .LVU378
 480:FML/Src/EC2x.c ****         msg_send->txmsg = tx_data;
 1555              		.loc 1 480 27 is_stmt 0 view .LVU379
 1556 007e A7F80880 		strh	r8, [r7, #8]	@ movhi
 481:FML/Src/EC2x.c **** 
 1557              		.loc 1 481 9 is_stmt 1 view .LVU380
 481:FML/Src/EC2x.c **** 
 1558              		.loc 1 481 25 is_stmt 0 view .LVU381
 1559 0082 C7F80090 		str	r9, [r7]
 483:FML/Src/EC2x.c ****         queue_insert(&ec2x_event_queue,(uint8_t)CMDSend_Event);
 1560              		.loc 1 483 9 is_stmt 1 view .LVU382
 1561 0086 3946     		mov	r1, r7
 1562 0088 0548     		ldr	r0, .L108+8
 1563 008a FFF7FEFF 		bl	queue_insert
 1564              	.LVL136:
 484:FML/Src/EC2x.c ****         
 1565              		.loc 1 484 9 view .LVU383
 1566 008e 0321     		movs	r1, #3
 1567 0090 0448     		ldr	r0, .L108+12
 1568 0092 FFF7FEFF 		bl	queue_insert
 1569              	.LVL137:
 1570              	.LBE15:
 1571              	.LBE16:
 1572              		.loc 1 487 1 is_stmt 0 view .LVU384
 1573 0096 C9E7     		b	.L104
 1574              	.L109:
 1575              		.align	2
 1576              	.L108:
 1577 0098 00000000 		.word	.LC6
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 43


 1578 009c 1F85EB51 		.word	1374389535
 1579 00a0 00000000 		.word	.LANCHOR2
 1580 00a4 00000000 		.word	.LANCHOR1
 1581              		.cfi_endproc
 1582              	.LFE305:
 1584              		.global	shellCommandec2x_send
 1585              		.global	shellDescec2x_send
 1586              		.global	shellCmdec2x_send
 1587              		.global	ec2x_dev
 1588              		.global	cur_msg
 1589              		.global	ec2x_txmsg_queue
 1590              		.global	ec2x_txmsg_buff
 1591              		.global	connectmsg_queue
 1592              		.section	.rodata.str1.4,"aMS",%progbits,1
 1593              		.align	2
 1594              	.LC7:
 1595 0000 41542B43 		.ascii	"AT+CPIN?\015\012\000"
 1595      50494E3F 
 1595      0D0A00
 1596 000b 00       		.align	2
 1597              	.LC8:
 1598 000c 2B435049 		.ascii	"+CPIN: READY\000"
 1598      4E3A2052 
 1598      45414459 
 1598      00
 1599 0019 000000   		.align	2
 1600              	.LC9:
 1601 001c 41542B43 		.ascii	"AT+CREG?\015\012\000"
 1601      5245473F 
 1601      0D0A00
 1602 0027 00       		.align	2
 1603              	.LC10:
 1604 0028 2B435245 		.ascii	"+CREG: 0,1\000"
 1604      473A2030 
 1604      2C3100
 1605 0033 00       		.align	2
 1606              	.LC11:
 1607 0034 41542B43 		.ascii	"AT+CGREG?\015\012\000"
 1607      47524547 
 1607      3F0D0A00 
 1608              		.align	2
 1609              	.LC12:
 1610 0040 2B434752 		.ascii	"+CGREG: 0,1\000"
 1610      45473A20 
 1610      302C3100 
 1611              		.align	2
 1612              	.LC13:
 1613 004c 41542B51 		.ascii	"AT+QICSGP=1,1,\"CMNET\",\"\",\"\",1\015\012\000"
 1613      49435347 
 1613      503D312C 
 1613      312C2243 
 1613      4D4E4554 
 1614              		.align	2
 1615              	.LC14:
 1616 006c 4F4B00   		.ascii	"OK\000"
 1617 006f 00       		.align	2
 1618              	.LC15:
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 44


 1619 0070 41542B51 		.ascii	"AT+QIDEACT=1\015\012\000"
 1619      49444541 
 1619      43543D31 
 1619      0D0A00
 1620 007f 00       		.align	2
 1621              	.LC16:
 1622 0080 41542B51 		.ascii	"AT+QIACT=1\015\012\000"
 1622      49414354 
 1622      3D310D0A 
 1622      00
 1623 008d 000000   		.align	2
 1624              	.LC17:
 1625 0090 2B51494F 		.ascii	"+QIOPEN:\000"
 1625      50454E3A 
 1625      00
 1626              		.global	tcpconnct_step
 1627              		.global	tcp_connect
 1628              		.global	ec2x_event_queue
 1629              		.global	event_buff
 1630              		.global	ec2x_transtable
 1631              		.global	ec2x_fsm
 1632              		.global	ec2x_buff
 1633              		.section	.bss.cur_msg,"aw",%nobits
 1634              		.align	2
 1635              		.set	.LANCHOR3,. + 0
 1638              	cur_msg:
 1639 0000 00000000 		.space	4
 1640              		.section	.bss.ec2x_event_queue,"aw",%nobits
 1641              		.align	2
 1642              		.set	.LANCHOR1,. + 0
 1645              	ec2x_event_queue:
 1646 0000 00000000 		.space	16
 1646      00000000 
 1646      00000000 
 1646      00000000 
 1647              		.section	.bss.ec2x_fsm,"aw",%nobits
 1648              		.align	2
 1649              		.set	.LANCHOR8,. + 0
 1652              	ec2x_fsm:
 1653 0000 00000000 		.space	12
 1653      00000000 
 1653      00000000 
 1654              		.section	.bss.ec2x_txmsg_buff,"aw",%nobits
 1655              		.align	2
 1656              		.set	.LANCHOR6,. + 0
 1659              	ec2x_txmsg_buff:
 1660 0000 00000000 		.space	60
 1660      00000000 
 1660      00000000 
 1660      00000000 
 1660      00000000 
 1661              		.section	.bss.ec2x_txmsg_queue,"aw",%nobits
 1662              		.align	2
 1663              		.set	.LANCHOR2,. + 0
 1666              	ec2x_txmsg_queue:
 1667 0000 00000000 		.space	16
 1667      00000000 
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 45


 1667      00000000 
 1667      00000000 
 1668              		.section	.bss.event_buff,"aw",%nobits
 1669              		.align	2
 1670              		.set	.LANCHOR5,. + 0
 1673              	event_buff:
 1674 0000 00000000 		.space	10
 1674      00000000 
 1674      0000
 1675              		.section	.bss.tcpconnct_step,"aw",%nobits
 1678              	tcpconnct_step:
 1679 0000 00       		.space	1
 1680              		.section	.bss.timeout_cnt,"aw",%nobits
 1681              		.set	.LANCHOR0,. + 0
 1684              	timeout_cnt:
 1685 0000 00       		.space	1
 1686              		.section	.data.connectmsg_queue,"aw"
 1687              		.align	2
 1688              		.set	.LANCHOR9,. + 0
 1691              	connectmsg_queue:
 1692 0000 00000000 		.word	.LC7
 1693 0004 0C000000 		.word	.LC8
 1694 0008 F401     		.short	500
 1695 000a 05       		.byte	5
 1696 000b 00       		.space	1
 1697 000c 1C000000 		.word	.LC9
 1698 0010 28000000 		.word	.LC10
 1699 0014 F401     		.short	500
 1700 0016 02       		.byte	2
 1701 0017 00       		.space	1
 1702 0018 34000000 		.word	.LC11
 1703 001c 40000000 		.word	.LC12
 1704 0020 F401     		.short	500
 1705 0022 02       		.byte	2
 1706 0023 00       		.space	1
 1707 0024 4C000000 		.word	.LC13
 1708 0028 6C000000 		.word	.LC14
 1709 002c F401     		.short	500
 1710 002e 03       		.byte	3
 1711 002f 00       		.space	1
 1712 0030 70000000 		.word	.LC15
 1713 0034 6C000000 		.word	.LC14
 1714 0038 2800     		.short	40
 1715 003a 01       		.byte	1
 1716 003b 00       		.space	1
 1717 003c 80000000 		.word	.LC16
 1718 0040 6C000000 		.word	.LC14
 1719 0044 9600     		.short	150
 1720 0046 01       		.byte	1
 1721 0047 00       		.space	1
 1722 0048 00000000 		.word	tcp_connect
 1723 004c 90000000 		.word	.LC17
 1724 0050 9600     		.short	150
 1725 0052 05       		.byte	5
 1726 0053 00       		.space	1
 1727              		.section	.data.ec2x_buff,"aw"
 1728              		.align	2
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 46


 1731              	ec2x_buff:
 1732 0000 FF00     		.ascii	"\377\000"
 1733 0002 00000000 		.space	198
 1733      00000000 
 1733      00000000 
 1733      00000000 
 1733      00000000 
 1734              		.section	.data.ec2x_dev,"aw"
 1735              		.align	2
 1736              		.set	.LANCHOR4,. + 0
 1739              	ec2x_dev:
 1740 0000 75617274 		.ascii	"uart1/ec200s\000"
 1740      312F6563 
 1740      32303073 
 1740      00
 1741 000d 0000     		.space	2
 1742 000f 00       		.space	1
 1743 0010 00000000 		.word	huart1
 1744 0014 00000048 		.word	1207959552
 1745 0018 0010     		.short	4096
 1746 001a 0000     		.space	2
 1747 001c 00000048 		.word	1207959552
 1748 0020 0001     		.short	256
 1749 0022 0000     		.space	2
 1750 0024 00000048 		.word	1207959552
 1751 0028 0008     		.short	2048
 1752 002a 0000     		.space	2
 1753 002c 00       		.byte	0
 1754 002d 000000   		.space	3
 1755 0030 00000000 		.word	ec2x_buff
 1756 0034 0000     		.short	0
 1757 0036 0000     		.short	0
 1758 0038 0000     		.short	0
 1759 003a C800     		.short	200
 1760              		.section	.data.ec2x_transtable,"aw"
 1761              		.align	2
 1762              		.set	.LANCHOR7,. + 0
 1765              	ec2x_transtable:
 1766 0000 00       		.byte	0
 1767 0001 01       		.byte	1
 1768 0002 00       		.byte	0
 1769 0003 00       		.space	1
 1770 0004 00000000 		.word	ec2x_reset
 1771 0008 00       		.byte	0
 1772 0009 02       		.byte	2
 1773 000a 01       		.byte	1
 1774 000b 00       		.space	1
 1775 000c 00000000 		.word	0
 1776 0010 01       		.byte	1
 1777 0011 03       		.byte	3
 1778 0012 02       		.byte	2
 1779 0013 00       		.space	1
 1780 0014 00000000 		.word	ec2x_queue_send
 1781 0018 02       		.byte	2
 1782 0019 02       		.byte	2
 1783 001a 01       		.byte	1
 1784 001b 00       		.space	1
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 47


 1785 001c 00000000 		.word	ec2x_reply_handler
 1786 0020 02       		.byte	2
 1787 0021 01       		.byte	1
 1788 0022 01       		.byte	1
 1789 0023 00       		.space	1
 1790 0024 00000000 		.word	ex2x_timeout_handler
 1791 0028 03       		.byte	3
 1792 0029 04       		.byte	4
 1793 002a 03       		.byte	3
 1794 002b 00       		.space	1
 1795 002c 00000000 		.word	0
 1796              		.section	.data.tcp_connect,"aw"
 1797              		.align	2
 1800              	tcp_connect:
 1801 0000 41542B51 		.ascii	"AT+QIOPEN=1,0,\"TCP\",\"115.236.153.170\",52894,0,2"
 1801      494F5045 
 1801      4E3D312C 
 1801      302C2254 
 1801      4350222C 
 1802 002f 00       		.ascii	"\000"
 1803              		.section	.rodata.shellCmdec2x_send,"a"
 1804              		.align	2
 1807              	shellCmdec2x_send:
 1808 0000 65633278 		.ascii	"ec2x_send\000"
 1808      5F73656E 
 1808      6400
 1809              		.section	.rodata.shellDescec2x_send,"a"
 1810              		.align	2
 1813              	shellDescec2x_send:
 1814 0000 65633278 		.ascii	"ec2x test\000"
 1814      20746573 
 1814      7400
 1815              		.section	shellCommand,"a"
 1818              	shellCommandec2x_send:
 1819 0000 00210000 		.4byte	8448
 1820 0004 00000000 		.4byte	shellCmdec2x_send
 1821 0008 00000000 		.4byte	EC2x_Test
 1822 000c 00000000 		.4byte	shellDescec2x_send
 1823              		.text
 1824              	.Letext0:
 1825              		.file 2 "e:\\gcc-arm-none-eabi-10.3-2021.10-win32\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\
 1826              		.file 3 "e:\\gcc-arm-none-eabi-10.3-2021.10-win32\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\
 1827              		.file 4 "Drivers/CMSIS/Device/ST/STM32L4xx/Include/stm32l431xx.h"
 1828              		.file 5 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_def.h"
 1829              		.file 6 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_gpio.h"
 1830              		.file 7 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_dma.h"
 1831              		.file 8 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_uart.h"
 1832              		.file 9 "FML/Inc/EC2x.h"
 1833              		.file 10 "ThirdParty/Letter-shell/Inc/shell.h"
 1834              		.file 11 "HAL/Inc/usart.h"
 1835              		.file 12 "ThirdParty/Letter-shell/Inc/shell_port.h"
 1836              		.file 13 "ThirdParty/FSM/fsm.h"
 1837              		.file 14 "HAL/Inc/queue.h"
 1838              		.file 15 "<built-in>"
 1839              		.file 16 "HAL/Inc/timer.h"
 1840              		.file 17 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal.h"
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 48


DEFINED SYMBOLS
                            *ABS*:00000000 EC2x.c
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:20     .text.ec2x_waitreply:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:25     .text.ec2x_waitreply:00000000 ec2x_waitreply
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:62     .text.ec2x_waitreply:00000020 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:929    .text.ec2x_replymatch:00000000 ec2x_replymatch
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:69     .rodata.ec2x_reset.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:73     .text.ec2x_reset:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:78     .text.ec2x_reset:00000000 ec2x_reset
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:109    .text.ec2x_reset:00000018 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:115    .text.ec2x_reply_handler:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:121    .text.ec2x_reply_handler:00000000 ec2x_reply_handler
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:203    .text.ec2x_reply_handler:0000004c $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:210    .text.ex2x_timeout_handler:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:216    .text.ex2x_timeout_handler:00000000 ex2x_timeout_handler
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:299    .text.ex2x_timeout_handler:00000050 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:306    .text.ec2x_io_init:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:312    .text.ec2x_io_init:00000000 ec2x_io_init
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:450    .text.ec2x_io_init:00000090 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:455    .text.ec2x_open:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:461    .text.ec2x_open:00000000 ec2x_open
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:562    .text.ec2x_open:00000064 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:575    .text.ec2x_write:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:581    .text.ec2x_write:00000000 ec2x_write
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:626    .text.ec2x_write:00000024 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:631    .text.ec2x_cmd_send:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:636    .text.ec2x_cmd_send:00000000 ec2x_cmd_send
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:669    .text.ec2x_queue_send:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:675    .text.ec2x_queue_send:00000000 ec2x_queue_send
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:734    .text.ec2x_queue_send:00000038 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:740    .text.ec2x_read:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:746    .text.ec2x_read:00000000 ec2x_read
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:910    .text.ec2x_read:000000a8 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:916    .rodata.ec2x_replymatch.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:923    .text.ec2x_replymatch:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1041   .text.ec2x_replymatch:00000068 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1050   .rodata.ec2x_handler.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1054   .text.ec2x_handler:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1060   .text.ec2x_handler:00000000 ec2x_handler
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1245   .text.ec2x_handler:000000e0 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1253   .rodata.ec2x_fms_proccess.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1260   .text.ec2x_fms_proccess:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1266   .text.ec2x_fms_proccess:00000000 ec2x_fms_proccess
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1338   .text.ec2x_fms_proccess:0000004c $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1347   .text.ec2x_tcp_connect:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1353   .text.ec2x_tcp_connect:00000000 ec2x_tcp_connect
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1409   .text.ec2x_tcp_connect:00000028 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1416   .rodata.EC2x_Test.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1420   .text.EC2x_Test:00000000 $t
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1426   .text.EC2x_Test:00000000 EC2x_Test
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1577   .text.EC2x_Test:00000098 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1818   shellCommand:00000000 shellCommandec2x_send
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1813   .rodata.shellDescec2x_send:00000000 shellDescec2x_send
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1807   .rodata.shellCmdec2x_send:00000000 shellCmdec2x_send
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1739   .data.ec2x_dev:00000000 ec2x_dev
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1638   .bss.cur_msg:00000000 cur_msg
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1666   .bss.ec2x_txmsg_queue:00000000 ec2x_txmsg_queue
ARM GAS  C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s 			page 49


C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1659   .bss.ec2x_txmsg_buff:00000000 ec2x_txmsg_buff
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1691   .data.connectmsg_queue:00000000 connectmsg_queue
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1593   .rodata.str1.4:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1678   .bss.tcpconnct_step:00000000 tcpconnct_step
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1800   .data.tcp_connect:00000000 tcp_connect
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1645   .bss.ec2x_event_queue:00000000 ec2x_event_queue
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1673   .bss.event_buff:00000000 event_buff
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1765   .data.ec2x_transtable:00000000 ec2x_transtable
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1652   .bss.ec2x_fsm:00000000 ec2x_fsm
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1731   .data.ec2x_buff:00000000 ec2x_buff
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1634   .bss.cur_msg:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1641   .bss.ec2x_event_queue:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1648   .bss.ec2x_fsm:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1655   .bss.ec2x_txmsg_buff:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1662   .bss.ec2x_txmsg_queue:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1669   .bss.event_buff:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1679   .bss.tcpconnct_step:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1684   .bss.timeout_cnt:00000000 timeout_cnt
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1685   .bss.timeout_cnt:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1687   .data.connectmsg_queue:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1728   .data.ec2x_buff:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1735   .data.ec2x_dev:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1761   .data.ec2x_transtable:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1797   .data.tcp_connect:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1804   .rodata.shellCmdec2x_send:00000000 $d
C:\Users\CL\AppData\Local\Temp\ccIuoNXR.s:1810   .rodata.shellDescec2x_send:00000000 $d

UNDEFINED SYMBOLS
timer_insert
queue_insert
queue_is_empty
queue_pop
free
HAL_GPIO_Init
HAL_GPIO_WritePin
HAL_Delay
strcmp
queue_init
FSM_Regist
HAL_UART_Transmit_IT
queue_pull
memset
strstr
shellPrint
shell
FSM_EventHandle
strlen
malloc
memcpy
huart1
