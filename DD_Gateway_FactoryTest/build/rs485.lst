ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 1


   1              		.cpu cortex-m4
   2              		.arch armv7e-m
   3              		.fpu fpv4-sp-d16
   4              		.eabi_attribute 27, 1
   5              		.eabi_attribute 28, 1
   6              		.eabi_attribute 20, 1
   7              		.eabi_attribute 21, 1
   8              		.eabi_attribute 23, 3
   9              		.eabi_attribute 24, 1
  10              		.eabi_attribute 25, 1
  11              		.eabi_attribute 26, 1
  12              		.eabi_attribute 30, 1
  13              		.eabi_attribute 34, 1
  14              		.eabi_attribute 18, 4
  15              		.file	"rs485.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.RS485_Init,"ax",%progbits
  20              		.align	1
  21              		.global	RS485_Init
  22              		.syntax unified
  23              		.thumb
  24              		.thumb_func
  26              	RS485_Init:
  27              	.LVL0:
  28              	.LFB288:
  29              		.file 1 "FML/Src/rs485.c"
   1:FML/Src/rs485.c **** /*----------------------------------include-----------------------------------*/
   2:FML/Src/rs485.c **** #include "rs485.h"
   3:FML/Src/rs485.c **** #include "usart.h"
   4:FML/Src/rs485.c **** #include "shell_port.h"
   5:FML/Src/rs485.c **** /*-----------------------------------macro------------------------------------*/
   6:FML/Src/rs485.c **** 
   7:FML/Src/rs485.c **** /*----------------------------------typedef-----------------------------------*/
   8:FML/Src/rs485.c **** 
   9:FML/Src/rs485.c **** /*----------------------------------variable----------------------------------*/
  10:FML/Src/rs485.c **** 
  11:FML/Src/rs485.c **** RS485_HandleTypeDef dev_rs485[] ={
  12:FML/Src/rs485.c ****     {
  13:FML/Src/rs485.c ****         &huart3,
  14:FML/Src/rs485.c ****         GPIOB,
  15:FML/Src/rs485.c ****         GPIO_PIN_2
  16:FML/Src/rs485.c ****     }
  17:FML/Src/rs485.c **** };
  18:FML/Src/rs485.c **** /*-------------------------------------os-------------------------------------*/
  19:FML/Src/rs485.c **** 
  20:FML/Src/rs485.c **** /*----------------------------------function----------------------------------*/
  21:FML/Src/rs485.c **** void RS485_Init(RS485_HandleTypeDef *rs485) {
  30              		.loc 1 21 45 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 24
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		.loc 1 21 45 is_stmt 0 view .LVU1
  35 0000 30B5     		push	{r4, r5, lr}
  36              	.LCFI0:
  37              		.cfi_def_cfa_offset 12
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 2


  38              		.cfi_offset 4, -12
  39              		.cfi_offset 5, -8
  40              		.cfi_offset 14, -4
  41 0002 87B0     		sub	sp, sp, #28
  42              	.LCFI1:
  43              		.cfi_def_cfa_offset 40
  44 0004 0446     		mov	r4, r0
  22:FML/Src/rs485.c ****     GPIO_InitTypeDef GPIO_InitStruct = {0};
  45              		.loc 1 22 5 is_stmt 1 view .LVU2
  46              		.loc 1 22 22 is_stmt 0 view .LVU3
  47 0006 0025     		movs	r5, #0
  48 0008 0195     		str	r5, [sp, #4]
  49 000a 0295     		str	r5, [sp, #8]
  50 000c 0395     		str	r5, [sp, #12]
  51 000e 0495     		str	r5, [sp, #16]
  52 0010 0595     		str	r5, [sp, #20]
  23:FML/Src/rs485.c ****     
  24:FML/Src/rs485.c ****     // 使能UART和GPIO时钟
  25:FML/Src/rs485.c ****     //__HAL_RCC_UARTX_CLK_ENABLE(); // 替换为实际的UART时钟
  26:FML/Src/rs485.c ****     __HAL_RCC_GPIOB_CLK_ENABLE(); // 替换为实际的GPIO时钟
  53              		.loc 1 26 5 is_stmt 1 view .LVU4
  54              	.LBB2:
  55              		.loc 1 26 5 view .LVU5
  56              		.loc 1 26 5 view .LVU6
  57 0012 0C4B     		ldr	r3, .L3
  58 0014 DA6C     		ldr	r2, [r3, #76]
  59 0016 42F00202 		orr	r2, r2, #2
  60 001a DA64     		str	r2, [r3, #76]
  61              		.loc 1 26 5 view .LVU7
  62 001c DB6C     		ldr	r3, [r3, #76]
  63 001e 03F00203 		and	r3, r3, #2
  64 0022 0093     		str	r3, [sp]
  65              		.loc 1 26 5 view .LVU8
  66 0024 009B     		ldr	r3, [sp]
  67              	.LBE2:
  68              		.loc 1 26 5 view .LVU9
  27:FML/Src/rs485.c ****     
  28:FML/Src/rs485.c ****     // 配置GPIO引脚
  29:FML/Src/rs485.c ****     GPIO_InitStruct.Pin = rs485->de_pin;
  69              		.loc 1 29 5 view .LVU10
  70              		.loc 1 29 32 is_stmt 0 view .LVU11
  71 0026 0389     		ldrh	r3, [r0, #8]
  72              		.loc 1 29 25 view .LVU12
  73 0028 0193     		str	r3, [sp, #4]
  30:FML/Src/rs485.c ****     GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  74              		.loc 1 30 5 is_stmt 1 view .LVU13
  75              		.loc 1 30 26 is_stmt 0 view .LVU14
  76 002a 0123     		movs	r3, #1
  77 002c 0293     		str	r3, [sp, #8]
  31:FML/Src/rs485.c ****     GPIO_InitStruct.Pull = GPIO_NOPULL;
  78              		.loc 1 31 5 is_stmt 1 view .LVU15
  32:FML/Src/rs485.c ****     GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  79              		.loc 1 32 5 view .LVU16
  33:FML/Src/rs485.c ****     HAL_GPIO_Init(rs485->de_port, &GPIO_InitStruct);
  80              		.loc 1 33 5 view .LVU17
  81 002e 01A9     		add	r1, sp, #4
  82 0030 4068     		ldr	r0, [r0, #4]
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 3


  83              	.LVL1:
  84              		.loc 1 33 5 is_stmt 0 view .LVU18
  85 0032 FFF7FEFF 		bl	HAL_GPIO_Init
  86              	.LVL2:
  34:FML/Src/rs485.c ****     
  35:FML/Src/rs485.c ****     // 初始化UART
  36:FML/Src/rs485.c ****     // rs485->huart.Instance = USART3;
  37:FML/Src/rs485.c ****     // rs485->huart.Init.BaudRate = 115200;
  38:FML/Src/rs485.c ****     // rs485->huart.Init.WordLength = UART_WORDLENGTH_8B;
  39:FML/Src/rs485.c ****     // rs485->huart.Init.StopBits = UART_STOPBITS_1;
  40:FML/Src/rs485.c ****     // rs485->huart.Init.Parity = UART_PARITY_NONE;
  41:FML/Src/rs485.c ****     // rs485->huart.Init.Mode = UART_MODE_TX_RX;
  42:FML/Src/rs485.c ****     // rs485->huart.Init.HwFlowCtl = UART_HWCONTROL_NONE;
  43:FML/Src/rs485.c ****     // rs485->huart.Init.OverSampling = UART_OVERSAMPLING_16;
  44:FML/Src/rs485.c ****     // rs485->huart.Init.OneBitSampling = UART_ONE_BIT_SAMPLE_DISABLE;
  45:FML/Src/rs485.c ****     // rs485->huart.AdvancedInit.AdvFeatureInit = UART_ADVFEATURE_NO_INIT;
  46:FML/Src/rs485.c ****     // HAL_UART_Init(rs485->huart);
  47:FML/Src/rs485.c ****     
  48:FML/Src/rs485.c ****     // 初始化DE引脚为发送模式
  49:FML/Src/rs485.c ****     HAL_GPIO_WritePin(rs485->de_port, rs485->de_pin, GPIO_PIN_RESET);
  87              		.loc 1 49 5 is_stmt 1 view .LVU19
  88 0036 2A46     		mov	r2, r5
  89 0038 2189     		ldrh	r1, [r4, #8]
  90 003a 6068     		ldr	r0, [r4, #4]
  91 003c FFF7FEFF 		bl	HAL_GPIO_WritePin
  92              	.LVL3:
  50:FML/Src/rs485.c **** }
  93              		.loc 1 50 1 is_stmt 0 view .LVU20
  94 0040 07B0     		add	sp, sp, #28
  95              	.LCFI2:
  96              		.cfi_def_cfa_offset 12
  97              		@ sp needed
  98 0042 30BD     		pop	{r4, r5, pc}
  99              	.LVL4:
 100              	.L4:
 101              		.loc 1 50 1 view .LVU21
 102              		.align	2
 103              	.L3:
 104 0044 00100240 		.word	1073876992
 105              		.cfi_endproc
 106              	.LFE288:
 108              		.section	.text.RS485_SendData,"ax",%progbits
 109              		.align	1
 110              		.global	RS485_SendData
 111              		.syntax unified
 112              		.thumb
 113              		.thumb_func
 115              	RS485_SendData:
 116              	.LVL5:
 117              	.LFB289:
  51:FML/Src/rs485.c **** 
  52:FML/Src/rs485.c **** void RS485_SendData(RS485_HandleTypeDef *rs485, uint8_t *data, uint16_t size) {
 118              		.loc 1 52 79 is_stmt 1 view -0
 119              		.cfi_startproc
 120              		@ args = 0, pretend = 0, frame = 0
 121              		@ frame_needed = 0, uses_anonymous_args = 0
 122              		.loc 1 52 79 is_stmt 0 view .LVU23
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 4


 123 0000 70B5     		push	{r4, r5, r6, lr}
 124              	.LCFI3:
 125              		.cfi_def_cfa_offset 16
 126              		.cfi_offset 4, -16
 127              		.cfi_offset 5, -12
 128              		.cfi_offset 6, -8
 129              		.cfi_offset 14, -4
 130 0002 0446     		mov	r4, r0
 131 0004 0D46     		mov	r5, r1
 132 0006 1646     		mov	r6, r2
  53:FML/Src/rs485.c ****     // 切换到发送模式
  54:FML/Src/rs485.c ****     HAL_GPIO_WritePin(rs485->de_port, rs485->de_pin, GPIO_PIN_SET);
 133              		.loc 1 54 5 is_stmt 1 view .LVU24
 134 0008 0122     		movs	r2, #1
 135              	.LVL6:
 136              		.loc 1 54 5 is_stmt 0 view .LVU25
 137 000a 0189     		ldrh	r1, [r0, #8]
 138              	.LVL7:
 139              		.loc 1 54 5 view .LVU26
 140 000c 4068     		ldr	r0, [r0, #4]
 141              	.LVL8:
 142              		.loc 1 54 5 view .LVU27
 143 000e FFF7FEFF 		bl	HAL_GPIO_WritePin
 144              	.LVL9:
  55:FML/Src/rs485.c ****     
  56:FML/Src/rs485.c ****     // 发送数据
  57:FML/Src/rs485.c ****     HAL_UART_Transmit(rs485->huart, data, size, HAL_MAX_DELAY);
 145              		.loc 1 57 5 is_stmt 1 view .LVU28
 146 0012 4FF0FF33 		mov	r3, #-1
 147 0016 3246     		mov	r2, r6
 148 0018 2946     		mov	r1, r5
 149 001a 2068     		ldr	r0, [r4]
 150 001c FFF7FEFF 		bl	HAL_UART_Transmit
 151              	.LVL10:
  58:FML/Src/rs485.c ****     
  59:FML/Src/rs485.c ****     // 切换到接收模式
  60:FML/Src/rs485.c ****     HAL_GPIO_WritePin(rs485->de_port, rs485->de_pin, GPIO_PIN_RESET);
 152              		.loc 1 60 5 view .LVU29
 153 0020 0022     		movs	r2, #0
 154 0022 2189     		ldrh	r1, [r4, #8]
 155 0024 6068     		ldr	r0, [r4, #4]
 156 0026 FFF7FEFF 		bl	HAL_GPIO_WritePin
 157              	.LVL11:
  61:FML/Src/rs485.c **** }
 158              		.loc 1 61 1 is_stmt 0 view .LVU30
 159 002a 70BD     		pop	{r4, r5, r6, pc}
 160              		.loc 1 61 1 view .LVU31
 161              		.cfi_endproc
 162              	.LFE289:
 164              		.section	.text.RS485_Test,"ax",%progbits
 165              		.align	1
 166              		.global	RS485_Test
 167              		.syntax unified
 168              		.thumb
 169              		.thumb_func
 171              	RS485_Test:
 172              	.LVL12:
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 5


 173              	.LFB291:
  62:FML/Src/rs485.c **** 
  63:FML/Src/rs485.c **** void RS485_ReceiveData(RS485_HandleTypeDef *rs485, uint8_t *data, uint16_t size) {
  64:FML/Src/rs485.c ****     // 切换到接收模式
  65:FML/Src/rs485.c ****     HAL_GPIO_WritePin(rs485->de_port, rs485->de_pin, GPIO_PIN_RESET);
  66:FML/Src/rs485.c ****     
  67:FML/Src/rs485.c ****     // 接收数据
  68:FML/Src/rs485.c ****     HAL_UART_Receive(rs485->huart, data, size, HAL_MAX_DELAY);
  69:FML/Src/rs485.c **** }
  70:FML/Src/rs485.c **** /*------------------------------------test------------------------------------*/
  71:FML/Src/rs485.c **** /**
  72:FML/Src/rs485.c ****  * @brief RS485测试函数
  73:FML/Src/rs485.c ****  *        使用RS485发送数据，通过接收器查看是否成功接收
  74:FML/Src/rs485.c ****  * 
  75:FML/Src/rs485.c ****  * @param str 
  76:FML/Src/rs485.c ****  */
  77:FML/Src/rs485.c **** void RS485_Test(char *str)
  78:FML/Src/rs485.c **** {
 174              		.loc 1 78 1 is_stmt 1 view -0
 175              		.cfi_startproc
 176              		@ args = 0, pretend = 0, frame = 0
 177              		@ frame_needed = 0, uses_anonymous_args = 0
 178              		.loc 1 78 1 is_stmt 0 view .LVU33
 179 0000 10B5     		push	{r4, lr}
 180              	.LCFI4:
 181              		.cfi_def_cfa_offset 8
 182              		.cfi_offset 4, -8
 183              		.cfi_offset 14, -4
 184 0002 0446     		mov	r4, r0
  79:FML/Src/rs485.c ****   RS485_SendData(&dev_rs485[0], (uint8_t *)str, strlen(str));
 185              		.loc 1 79 3 is_stmt 1 view .LVU34
 186              		.loc 1 79 49 is_stmt 0 view .LVU35
 187 0004 FFF7FEFF 		bl	strlen
 188              	.LVL13:
 189              		.loc 1 79 3 view .LVU36
 190 0008 82B2     		uxth	r2, r0
 191 000a 2146     		mov	r1, r4
 192 000c 0148     		ldr	r0, .L9
 193 000e FFF7FEFF 		bl	RS485_SendData
 194              	.LVL14:
  80:FML/Src/rs485.c **** }
 195              		.loc 1 80 1 view .LVU37
 196 0012 10BD     		pop	{r4, pc}
 197              	.LVL15:
 198              	.L10:
 199              		.loc 1 80 1 view .LVU38
 200              		.align	2
 201              	.L9:
 202 0014 00000000 		.word	.LANCHOR0
 203              		.cfi_endproc
 204              	.LFE291:
 206              		.section	.text.RS485_ReceiveData,"ax",%progbits
 207              		.align	1
 208              		.global	RS485_ReceiveData
 209              		.syntax unified
 210              		.thumb
 211              		.thumb_func
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 6


 213              	RS485_ReceiveData:
 214              	.LVL16:
 215              	.LFB290:
  63:FML/Src/rs485.c ****     // 切换到接收模式
 216              		.loc 1 63 82 is_stmt 1 view -0
 217              		.cfi_startproc
 218              		@ args = 0, pretend = 0, frame = 0
 219              		@ frame_needed = 0, uses_anonymous_args = 0
  63:FML/Src/rs485.c ****     // 切换到接收模式
 220              		.loc 1 63 82 is_stmt 0 view .LVU40
 221 0000 70B5     		push	{r4, r5, r6, lr}
 222              	.LCFI5:
 223              		.cfi_def_cfa_offset 16
 224              		.cfi_offset 4, -16
 225              		.cfi_offset 5, -12
 226              		.cfi_offset 6, -8
 227              		.cfi_offset 14, -4
 228 0002 0446     		mov	r4, r0
 229 0004 0D46     		mov	r5, r1
 230 0006 1646     		mov	r6, r2
  65:FML/Src/rs485.c ****     
 231              		.loc 1 65 5 is_stmt 1 view .LVU41
 232 0008 0022     		movs	r2, #0
 233              	.LVL17:
  65:FML/Src/rs485.c ****     
 234              		.loc 1 65 5 is_stmt 0 view .LVU42
 235 000a 0189     		ldrh	r1, [r0, #8]
 236              	.LVL18:
  65:FML/Src/rs485.c ****     
 237              		.loc 1 65 5 view .LVU43
 238 000c 4068     		ldr	r0, [r0, #4]
 239              	.LVL19:
  65:FML/Src/rs485.c ****     
 240              		.loc 1 65 5 view .LVU44
 241 000e FFF7FEFF 		bl	HAL_GPIO_WritePin
 242              	.LVL20:
  68:FML/Src/rs485.c **** }
 243              		.loc 1 68 5 is_stmt 1 view .LVU45
 244 0012 4FF0FF33 		mov	r3, #-1
 245 0016 3246     		mov	r2, r6
 246 0018 2946     		mov	r1, r5
 247 001a 2068     		ldr	r0, [r4]
 248 001c FFF7FEFF 		bl	HAL_UART_Receive
 249              	.LVL21:
  69:FML/Src/rs485.c **** /*------------------------------------test------------------------------------*/
 250              		.loc 1 69 1 is_stmt 0 view .LVU46
 251 0020 70BD     		pop	{r4, r5, r6, pc}
  69:FML/Src/rs485.c **** /*------------------------------------test------------------------------------*/
 252              		.loc 1 69 1 view .LVU47
 253              		.cfi_endproc
 254              	.LFE290:
 256              		.global	shellCommandrs485_send
 257              		.global	shellDescrs485_send
 258              		.global	shellCmdrs485_send
 259              		.global	dev_rs485
 260              		.section	.data.dev_rs485,"aw"
 261              		.align	2
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 7


 262              		.set	.LANCHOR0,. + 0
 265              	dev_rs485:
 266 0000 00000000 		.word	huart3
 267 0004 00040048 		.word	1207960576
 268 0008 0400     		.short	4
 269 000a 0000     		.space	2
 270              		.section	.rodata.shellCmdrs485_send,"a"
 271              		.align	2
 274              	shellCmdrs485_send:
 275 0000 72733438 		.ascii	"rs485_send\000"
 275      355F7365 
 275      6E6400
 276              		.section	.rodata.shellDescrs485_send,"a"
 277              		.align	2
 280              	shellDescrs485_send:
 281 0000 72733438 		.ascii	"rs485 send test\000"
 281      35207365 
 281      6E642074 
 281      65737400 
 282              		.section	shellCommand,"a"
 285              	shellCommandrs485_send:
 286 0000 00210000 		.4byte	8448
 287 0004 00000000 		.4byte	shellCmdrs485_send
 288 0008 00000000 		.4byte	RS485_Test
 289 000c 00000000 		.4byte	shellDescrs485_send
 290              		.text
 291              	.Letext0:
 292              		.file 2 "e:\\gcc-arm-none-eabi-10.3-2021.10-win32\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\
 293              		.file 3 "e:\\gcc-arm-none-eabi-10.3-2021.10-win32\\gcc-arm-none-eabi-10.3-2021.10\\arm-none-eabi\\
 294              		.file 4 "Drivers/CMSIS/Device/ST/STM32L4xx/Include/stm32l431xx.h"
 295              		.file 5 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_def.h"
 296              		.file 6 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_gpio.h"
 297              		.file 7 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_dma.h"
 298              		.file 8 "Drivers/STM32L4xx_HAL_Driver/Inc/stm32l4xx_hal_uart.h"
 299              		.file 9 "FML/Inc/rs485.h"
 300              		.file 10 "HAL/Inc/usart.h"
 301              		.file 11 "ThirdParty/Letter-shell/Inc/shell.h"
 302              		.file 12 "<built-in>"
ARM GAS  C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 rs485.c
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:20     .text.RS485_Init:00000000 $t
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:26     .text.RS485_Init:00000000 RS485_Init
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:104    .text.RS485_Init:00000044 $d
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:109    .text.RS485_SendData:00000000 $t
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:115    .text.RS485_SendData:00000000 RS485_SendData
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:165    .text.RS485_Test:00000000 $t
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:171    .text.RS485_Test:00000000 RS485_Test
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:202    .text.RS485_Test:00000014 $d
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:207    .text.RS485_ReceiveData:00000000 $t
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:213    .text.RS485_ReceiveData:00000000 RS485_ReceiveData
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:285    shellCommand:00000000 shellCommandrs485_send
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:280    .rodata.shellDescrs485_send:00000000 shellDescrs485_send
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:274    .rodata.shellCmdrs485_send:00000000 shellCmdrs485_send
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:265    .data.dev_rs485:00000000 dev_rs485
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:261    .data.dev_rs485:00000000 $d
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:271    .rodata.shellCmdrs485_send:00000000 $d
C:\Users\CL\AppData\Local\Temp\cc6c4ISh.s:277    .rodata.shellDescrs485_send:00000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_Init
HAL_GPIO_WritePin
HAL_UART_Transmit
strlen
HAL_UART_Receive
huart3
